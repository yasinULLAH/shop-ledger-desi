<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Pakistani Receipt Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gradient1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            direction: rtl;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: var(--shadow-lg);
        }

        .header {
            background: var(--gradient1);
            color: white;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-50px) translateY(-50px); }
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 20px;
            align-items: center;
        }

        .header-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-mini {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .stat-mini h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stat-mini p {
            font-size: 19px;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .quick-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 17px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .quick-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            background: var(--primary);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tab-btn {
            background: none;
            border: none;
            color: white;
            padding: 18px 10px;
            cursor: pointer;
            font-size: 19px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .tab-btn::before {
            content: '';
            font-size: 20px;
        }

        .tab-btn[data-tab="receipts"]::before { content: 'üìÑ'; }
        .tab-btn[data-tab="search"]::before { content: 'üîç'; }
        .tab-btn[data-tab="ledger"]::before { content: 'üìä'; }
        .tab-btn[data-tab="reports"]::before { content: 'üìà'; }
        .tab-btn[data-tab="reminders"]::before { content: '‚è∞'; }
        .tab-btn[data-tab="admin"]::before { content: '‚öôÔ∏è'; }

        .tab-btn.active {
            background: #34495e;
            border-bottom-color: var(--secondary);
        }

        .tab-btn:hover {
            background: #34495e;
            transform: translateY(-2px);
        }

        .tab-content {
            padding: 30px;
            display: none;
            min-height: calc(100vh - 200px);
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-form {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
            font-size: 16px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
            font-size: 19px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            direction: rtl;
            text-align: right;
            font-size: 19px;
            transition: all 0.3s;
            background: #fafbfc;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary);
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .sidebar-widgets {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .widget {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
        }

        .widget h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .quick-stat {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .quick-stat .number {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .quick-stat .label {
            font-size: 17px;
            color: #6c757d;
            margin-top: 5px;
        }

        .btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 19px;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary { background: var(--secondary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); }
        .btn-info { background: var(--info); }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            overflow: hidden;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            background: var(--gradient1);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        .receipt-item {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .receipt-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .receipt-header {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px 20px;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
        }

        .receipt-info h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 16px;
        }

        .receipt-info p {
            color: #6c757d;
            font-size: 19px;
            margin: 2px 0;
        }

        .receipt-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
        }

        .status-udhar {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .status-paid {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .receipt-actions {
            padding: 15px 20px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            background: #fafbfc;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 17px;
            border-radius: 6px;
        }

        .search-panel {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .search-header {
            background: var(--gradient2);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        .search-filters {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            position: relative;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient1);
        }

        .stat-card.success::before { background: var(--gradient3); }
        .stat-card.danger::before { background: var(--gradient2); }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 19px;
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 17px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .change-positive {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .change-negative {
            background: #ffebee;
            color: #c62828;
        }

        .ledger-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .ledger-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            text-align: center;
        }

        .ledger-item h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .ledger-item p {
            opacity: 0.9;
            font-size: 19px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 30px auto;
            padding: 0;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            position: relative;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            background: var(--gradient1);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close:hover {
            background: rgba(255,255,255,0.2);
        }

        .print-receipt {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border: 2px solid #ddd;
            font-family: 'Courier New', monospace;
            box-shadow: var(--shadow);
        }

        .receipt-business {
            text-align: center;
            border-bottom: 3px double #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .receipt-business img {
            max-height: 60px;
            margin-bottom: 10px;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 3px 0;
            border-bottom: 1px dotted #ccc;
        }

        .receipt-row:last-child {
            border-bottom: none;
        }

        .receipt-total {
            border-top: 3px double #000;
            margin-top: 15px;
            padding-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
            font-size: 17px;
            color: #666;
        }

        .floating-actions {
            position: fixed;
            bottom: 30px;
            left: 0px;
            z-index: 1000;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient1);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            margin-bottom: 15px;
            display: block;
            transition: all 0.3s;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(-100%);
            transition: all 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.info {
            background: var(--info);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient1);
            transition: width 0.3s;
        }

        .reminder-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .reminder-header {
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 100%);
            padding: 15px;
            color: white;
            font-weight: 600;
        }

        .reminder-body {
            padding: 15px;
        }

        .reminder-actions {
            padding: 10px 15px;
            background: #fafbfc;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .admin-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .settings-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        .section-header {
            background: var(--gradient1);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        .section-body {
            padding: 20px;
        }

        .data-management {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .backup-card {
            text-align: center;
            padding: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .backup-card:hover {
            border-color: var(--secondary);
            background: #f8f9fa;
        }

        .backup-icon {
            font-size: 36px;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar-widgets {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                display: grid;
            }
            
            .admin-panel {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-tabs {
                grid-template-columns: repeat(3, 1fr);
                overflow-x: auto;
            }
            
            .tab-btn {
                min-width: 100px;
                font-size: 17px;
                padding: 12px 8px;
            }
            
            .header-content {
                grid-template-columns: 1fr;
            }
            
            .header-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .floating-actions {
                bottom: 20px;
                left: 20px;
            }
            
            .fab {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .container {
                margin: 0;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .nav-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-dashboard {
                grid-template-columns: 1fr;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-receipt, .print-receipt * {
                visibility: visible;
            }
            .print-receipt {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<div class="header-content">
<div>
<h1>Pakistani Receipt Management System</h1>
<p>Professional Business Management Solution</p>
<p style="font-size: 17px; opacity: 0.8;">Developed by: Yasin Ullah (Pakistani Developer)</p>
</div>
<div class="header-stats">
<div class="stat-mini">
<h3 id="todayTotal">0</h3>
<p>ÿ¢ÿ¨ ⁄©€å ÿ≥€åŸÑÿ≤</p>
</div>
<div class="stat-mini">
<h3 id="totalUdhar">0</h3>
<p>⁄©ŸÑ ÿßÿØ⁄æÿßÿ±</p>
</div>
<div class="stat-mini">
<h3 id="totalCustomers">0</h3>
<p>⁄©ÿ≥ŸπŸÖÿ±ÿ≤</p>
</div>
</div>
<div class="header-actions">
<button class="quick-btn" onclick="quickReceipt()">ŸÅŸàÿ±€å ÿ±ÿ≥€åÿØ</button>
<button class="quick-btn" onclick="quickSearch()">ŸÅŸàÿ±€å ÿ™ŸÑÿßÿ¥</button>
<button class="quick-btn" onclick="todayReport()">ÿ¢ÿ¨ ⁄©€å ÿ±ŸæŸàÿ±Ÿπ</button>
</div>
</div>
</div>

        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="receipts" onclick="t1('receipts')">ÿ±ÿ≥€åÿØ</button>
            <button class="tab-btn" data-tab="search" onclick="t1('search')">ÿ™ŸÑÿßÿ¥</button>
            <button class="tab-btn" data-tab="ledger" onclick="t1('ledger')">⁄©⁄æÿßÿ™€Å</button>
            <button class="tab-btn" data-tab="reports" onclick="t1('reports')">ÿ±ŸæŸàÿ±Ÿπÿ≥</button>
            <button class="tab-btn" data-tab="reminders" onclick="t1('reminders')">€åÿßÿØÿØ€ÅÿßŸÜ€å</button>
            <button class="tab-btn" data-tab="admin" onclick="t1('admin')">ÿß€å⁄àŸÖŸÜ</button>
        </div>
    
        <div id="receipts" class="tab-content active">
            <div class="dashboard-grid">
                <div class="main-form">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">ŸÜÿ¶€å ÿ±ÿ≥€åÿØ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫</h2>
                    <form id="f1" onsubmit="a1(event)">
                        <div class="form-section">
                            <h3>ÿ®ŸÜ€åÿßÿØ€å ŸÖÿπŸÑŸàŸÖÿßÿ™</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±:</label>
                                    <input type="text" id="rn1" readonly>
                                </div>
                                <div class="form-group">
                                    <label>ÿ™ÿßÿ±€åÿÆ:</label>
                                    <input type="date" id="dt1" required>
                                </div>
                                <div class="form-group">
                                    <label>ŸàŸÇÿ™:</label>
                                    <input type="time" id="tm1">
                                </div>
                            </div>
                        </div>
    
                        <div class="form-section">
                            <h3>⁄©ÿ≥ŸπŸÖÿ± ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>⁄©ÿ≥ŸπŸÖÿ± ⁄©ÿß ŸÜÿßŸÖ:</label>
                                    <input type="text" id="nm1" required list="customerList">
                                    <datalist id="customerList"></datalist>
                                </div>
                                <div class="form-group">
                                    <label>ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ±:</label>
                                    <input type="tel" id="mb1" pattern="[0-9]{11}">
                                </div>
                                <div class="form-group">
                                    <label>Ÿæÿ™€Å:</label>
                                    <input type="text" id="ad1">
                                </div>
                                <div class="form-group">
                                    <label>CNIC:</label>
                                    <input type="text" id="cn1" pattern="[0-9]{5}-[0-9]{7}-[0-9]{1}">
                                </div>
                            </div>
                        </div>
    
                        <div class="form-section">
                            <h3>Ÿæÿ±Ÿà⁄à⁄©Ÿπ ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>ÿ¢ÿ¶ŸπŸÖ/ŸÖÿß⁄àŸÑ:</label>
                                    <input type="text" id="it1" required list="itemList">
                                    <datalist id="itemList"></datalist>
                                </div>
                                <div class="form-group">
                                    <label>ÿ®ÿ±ÿßŸÜ⁄à:</label>
                                    <input type="text" id="br1">
                                </div>
                                <div class="form-group">
                                    <label>ÿ™ÿπÿØÿßÿØ:</label>
                                    <input type="number" id="qt1" min="1" value="1" required>
                                </div>
                                <div class="form-group">
                                    <label>ŸÅ€å €åŸàŸÜŸπ ÿ±€åŸπ:</label>
                                    <input type="number" id="rt1" min="0" step="0.01" oninput="calculateTotal()">
                                </div>
                            </div>
                        </div>
    
                        <div class="form-section">
                            <h3>ŸÇ€åŸÖÿ™ ÿßŸàÿ± ÿßÿØÿßÿ¶€å⁄Ø€å</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>⁄©ŸÑ ÿ±ŸÇŸÖ:</label>
                                    <input type="number" id="pr1" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>⁄àÿ≥⁄©ÿßÿ§ŸÜŸπ:</label>
                                    <input type="number" id="dc1" min="0" step="0.01" value="0" oninput="calculateTotal()">
                                </div>
                                <div class="form-group">
                                    <label>Ÿπ€å⁄©ÿ≥:</label>
                                    <input type="number" id="tx1" min="0" step="0.01" value="0" oninput="calculateTotal()">
                                </div>
                                <div class="form-group">
                                    <label>ÿ≠ÿ™ŸÖ€å ÿ±ŸÇŸÖ:</label>
                                    <input type="number" id="fn1" readonly>
                                </div>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>ÿßÿØÿß ÿ¥ÿØ€Å ÿ±ŸÇŸÖ:</label>
                                    <input type="number" id="pd1" min="0" step="0.01" value="0" oninput="calculateBalance()">
                                </div>
                                <div class="form-group">
                                    <label>ÿ®ÿßŸÇ€å ÿ±ŸÇŸÖ:</label>
                                    <input type="number" id="bl1" readonly>
                                </div>
                                <div class="form-group">
                                    <label>ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©ÿß ÿ∑ÿ±€åŸÇ€Å:</label>
                                    <select id="pm1">
                                        <option value="ŸÜŸÇÿØ">ŸÜŸÇÿØ</option>
                                        <option value="ÿ®€åŸÜ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸÅÿ±">ÿ®€åŸÜ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸÅÿ±</option>
                                        <option value="⁄Ü€å⁄©">⁄Ü€å⁄©</option>
                                        <option value="ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ">ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©€å ÿ≠ÿßŸÑÿ™:</label>
                                    <select id="st1" required>
                                        <option value="ÿßÿØ⁄æÿßÿ±">ÿßÿØ⁄æÿßÿ±</option>
                                        <option value="ÿßÿØÿß ÿ¥ÿØ€Å">ÿßÿØÿß ÿ¥ÿØ€Å</option>
                                        <option value="ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å">ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å</option>
                                    </select>
                                </div>
                            </div>
                        </div>
    
                        <div class="form-section">
                            <h3>ŸÇÿ≥ÿ∑ ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>ŸÖ€Å€åŸÜ€í:</label>
                                    <input type="number" id="mt1" min="1" value="1">
                                </div>
                                <div class="form-group">
                                    <label>ŸÖÿß€ÅÿßŸÜ€Å ŸÇÿ≥ÿ∑:</label>
                                    <input type="number" id="mi1" readonly>
                                </div>
                                <div class="form-group">
                                    <label>ÿß⁄ØŸÑ€å ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©€å ÿ™ÿßÿ±€åÿÆ:</label>
                                    <input type="date" id="nd1">
                                </div>
                                <div class="form-group">
                                    <label>⁄Øÿßÿ±ŸÜŸπ€å (ŸÖ€Å€åŸÜ€í):</label>
                                    <input type="number" id="wr1" min="0" value="12">
                                </div>
                            </div>
                        </div>
    
                        <div class="form-section">
                            <h3>ÿßÿ∂ÿßŸÅ€å ŸÖÿπŸÑŸàŸÖÿßÿ™</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>ÿß€åÿ¨ŸÜŸπ/ÿ≥€åŸÑÿ≤ Ÿæÿ±ÿ≥ŸÜ:</label>
                                    <input type="text" id="ag1">
                                </div>
                                <div class="form-group">
                                    <label>ÿØÿ≥ÿ™ÿÆÿ∑/ŸÖŸÜÿ∏Ÿàÿ±€å:</label>
                                    <textarea id="sg1" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>ŸÜŸàŸπÿ≥:</label>
                                    <textarea id="nt1" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
    
                        <div class="btn-group">
                            <button type="submit" class="btn btn-success">ÿ±ÿ≥€åÿØ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                            <button type="button" class="btn btn-primary" onclick="saveAndPrint()">ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ± ⁄©€í Ÿæÿ±ŸÜŸπ ⁄©ÿ±€å⁄∫</button>
                            <button type="button" class="btn" onclick="r1()">ÿµÿßŸÅ ⁄©ÿ±€å⁄∫</button>
                            <button type="button" class="btn btn-info" onclick="previewReceipt()">Ÿæ€åÿ¥ ŸÜÿ∏ÿßÿ±€Å</button>
                        </div>
                    </form>
                </div>
    
                <div class="sidebar-widgets">
                    <div class="widget">
                        <h4>ÿ¢ÿ¨ ⁄©€í ÿßÿπÿØÿßÿØ Ÿà ÿ¥ŸÖÿßÿ±</h4>
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="number" id="todayReceipts">0</div>
                                <div class="label">ÿ±ÿ≥€åÿØ€å⁄∫</div>
                            </div>
                            <div class="quick-stat">
                                <div class="number" id="todayAmount">0</div>
                                <div class="label">ÿ±ŸÇŸÖ</div>
                            </div>
                            <div class="quick-stat">
                                <div class="number" id="todayPaid">0</div>
                                <div class="label">ÿßÿØÿß ÿ¥ÿØ€Å</div>
                            </div>
                            <div class="quick-stat">
                                <div class="number" id="todayPending">0</div>
                                <div class="label">ÿ®ÿßŸÇ€å</div>
                            </div>
                        </div>
                    </div>
    
                    <div class="widget">
                        <h4>ÿ≠ÿßŸÑ€å€Å ⁄©ÿ≥ŸπŸÖÿ±ÿ≤</h4>
                        <div id="recentCustomers"></div>
                    </div>
    
                    <div class="widget">
                        <h4>ŸÅŸàÿ±€å ÿß€å⁄©ÿ¥ŸÜ</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-sm btn-info" onclick="showPendingPayments()">ÿ®ÿßŸÇ€å ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫</button>
                            <button class="btn btn-sm btn-warning" onclick="showExpiringWarranties()">ÿÆÿ™ŸÖ €ÅŸàÿ™€å ⁄Øÿßÿ±ŸÜŸπ€åÿß⁄∫</button>
                            <button class="btn btn-sm btn-success" onclick="generateInvoice()">ÿßŸÜŸàÿßÿ¶ÿ≥ ÿ®ŸÜÿßÿ¶€å⁄∫</button>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="card">
                <div class="card-header">ÿ≠ÿßŸÑ€å€Å ÿ±ÿ≥€åÿØ€å⁄∫</div>
                <div class="card-body">
                    <div id="rl1"></div>
                </div>
            </div>
        </div>
    
        <div id="search" class="tab-content">
            <div class="search-panel">
                <div class="search-header">
                    <h2>ÿß€å⁄àŸàÿßŸÜÿ≥ ÿ≥ÿ±⁄Ü ÿßŸàÿ± ŸÅŸÑŸπÿ±ÿ≤</h2>
                </div>
                <div class="search-filters">
                    <div class="filter-group">
                        <label>ŸÜÿßŸÖ ÿ≥€í ÿ™ŸÑÿßÿ¥:</label>
                        <input type="text" id="sn1" oninput="s1()" placeholder="⁄©ÿ≥ŸπŸÖÿ± ⁄©ÿß ŸÜÿßŸÖ">
                    </div>
                    <div class="filter-group">
                        <label>ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ±:</label>
                        <input type="tel" id="sm1" oninput="s1()" placeholder="ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ±">
                    </div>
                    <div class="filter-group">
                        <label>ÿ¢ÿ¶ŸπŸÖ:</label>
                        <input type="text" id="si1" oninput="s1()" placeholder="Ÿæÿ±Ÿà⁄à⁄©Ÿπ ŸÜÿßŸÖ">
                    </div>
                    <div class="filter-group">
                        <label>ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±:</label>
                        <input type="text" id="sr1" oninput="s1()" placeholder="ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±">
                    </div>
                    <div class="filter-group">
                        <label>ÿ≠ÿßŸÑÿ™:</label>
                        <select id="ss1" onchange="s1()">
                            <option value="">ÿ™ŸÖÿßŸÖ</option>
                            <option value="ÿßÿØ⁄æÿßÿ±">ÿßÿØ⁄æÿßÿ±</option>
                            <option value="ÿßÿØÿß ÿ¥ÿØ€Å">ÿßÿØÿß ÿ¥ÿØ€Å</option>
                            <option value="ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å">ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>⁄©ŸÖ ÿ≥€í ⁄©ŸÖ ÿ±ŸÇŸÖ:</label>
                        <input type="number" id="mn1" onchange="s1()" min="0">
                    </div>
                    <div class="filter-group">
                        <label>ÿ≤€åÿßÿØ€Å ÿ≥€í ÿ≤€åÿßÿØ€Å ÿ±ŸÇŸÖ:</label>
                        <input type="number" id="mx1" onchange="s1()" min="0">
                    </div>
                    <div class="filter-group">
                        <label>ÿ¥ÿ±Ÿàÿπÿßÿ™€å ÿ™ÿßÿ±€åÿÆ:</label>
                        <input type="date" id="sd1" onchange="s1()">
                    </div>
                    <div class="filter-group">
                        <label>ÿ¢ÿÆÿ±€å ÿ™ÿßÿ±€åÿÆ:</label>
                        <input type="date" id="ed1" onchange="s1()">
                    </div>
                    <div class="filter-group">
                        <label>ÿ®ÿ±ÿßŸÜ⁄à:</label>
                        <input type="text" id="sb1" oninput="s1()" placeholder="ÿ®ÿ±ÿßŸÜ⁄à ŸÜÿßŸÖ">
                    </div>
                    <div class="filter-group">
                        <label>ÿß€åÿ¨ŸÜŸπ:</label>
                          <input type="text" name="fake-user" style="display:none">
  <input type="password" name="fake-pass" style="display:none">
                        <input type="text" id="sa1" name="dummy-sa1" oninput="s1()" value="" placeholder="ÿß€åÿ¨ŸÜŸπ ŸÜÿßŸÖ" autocomplete="off" autocorrect="off" spellcheck="false">

                    </div>
                    <div class="filter-group">
                        <label>ÿ™ÿ±ÿ™€åÿ®:</label>
                        <select id="so1" onchange="s1()">
                            <option value="date_desc">ÿ™ÿßÿ≤€Å ÿ™ÿ±€åŸÜ</option>
                            <option value="date_asc">Ÿæÿ±ÿßŸÜ€å ÿ™ÿ±€åŸÜ</option>
                            <option value="amount_desc">ÿ≤€åÿßÿØ€Å ÿ±ŸÇŸÖ</option>
                            <option value="amount_asc">⁄©ŸÖ ÿ±ŸÇŸÖ</option>
                        </select>
                    </div>
                </div>
                <div style="padding: 0 20px 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn" onclick="clearFilters()">ŸÅŸÑŸπÿ±ÿ≤ ÿµÿßŸÅ ⁄©ÿ±€å⁄∫</button>
                    <button class="btn btn-info" onclick="exportSearchResults()">ŸÜÿ™ÿßÿ¶ÿ¨ ÿß€å⁄©ÿ≥ŸæŸàÿ±Ÿπ ⁄©ÿ±€å⁄∫</button>
                    <button class="btn btn-success" onclick="bulkUpdate()">ÿ®ŸÑ⁄© ÿßŸæ⁄à€åŸπ</button>
                </div>
            </div>
    
            <div class="stats-dashboard">
                <div class="stat-card">
                    <div class="stat-number" id="searchTotal">0</div>
                    <div class="stat-label">ÿ™ŸÑÿßÿ¥ ⁄©€í ŸÜÿ™ÿßÿ¶ÿ¨</div>
                    <div class="stat-change change-positive" id="searchChange">ŸÜ€åÿß</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number" id="searchAmount">0</div>
                    <div class="stat-label">⁄©ŸÑ ÿ±ŸÇŸÖ</div>
                    <div class="stat-change change-positive" id="amountChange">+0%</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-number" id="searchPending">0</div>
                    <div class="stat-label">ÿ®ÿßŸÇ€å ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫</div>
                    <div class="stat-change change-negative" id="pendingChange">-0%</div>
                </div>
            </div>
    
            <div id="sr2" class="card-grid"></div>
        </div>
    
        <div id="ledger" class="tab-content">
            <div class="search-panel">
                <div class="search-header">
                    <h2>⁄©ÿ≥ŸπŸÖÿ± ŸÑ€åÿ¨ÿ± ÿßŸàÿ± ÿß⁄©ÿßÿ§ŸÜŸπÿ≥</h2>
                </div>
                <div style="padding: 20px;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>⁄©ÿ≥ŸπŸÖÿ± ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫:</label>
                            <select id="lc1" onchange="l1()">
                                <option value="">⁄©ÿ≥ŸπŸÖÿ± ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ŸÅŸÑŸπÿ±:</label>
                            <select id="lf1" onchange="l1()">
                                <option value="all">ÿ™ŸÖÿßŸÖ Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜ</option>
                                <option value="pending">ÿ®ÿßŸÇ€å ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫</option>
                                <option value="paid">ÿßÿØÿß ÿ¥ÿØ€Å</option>
                                <option value="current_month">ÿßÿ≥ ŸÖ€Å€åŸÜ€í</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÿ™ÿßÿ±€åÿÆ ÿ≥€í:</label>
                            <input type="date" id="ld1" onchange="l1()">
                        </div>
                        <div class="form-group">
                            <label>ÿ™ÿßÿ±€åÿÆ ÿ™⁄©:</label>
                            <input type="date" id="ld2" onchange="l1()">
                        </div>
                    </div>
                </div>
            </div>
    
            <div id="lb1" class="ledger-summary" style="display: none;">
                <div class="ledger-grid">
                    <div class="ledger-item">
                        <h3 id="totalTransactions">0</h3>
                        <p>⁄©ŸÑ Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜ</p>
                    </div>
                    <div class="ledger-item">
                        <h3 id="totalPurchases">0</h3>
                        <p>⁄©ŸÑ ÿÆÿ±€åÿØÿßÿ±€å</p>
                    </div>
                    <div class="ledger-item">
                        <h3 id="outstandingBalance">0</h3>
                        <p>ÿ®ÿßŸÇ€å ÿ®€åŸÑŸÜÿ≥</p>
                    </div>
                </div>
            </div>
    
            <div class="card-grid" id="customersList"></div>
            <div id="lt1"></div>
        </div>
    
        <div id="reports" class="tab-content">
            <div class="search-panel">
                <div class="search-header">
                    <h2>ÿ™ŸÅÿµ€åŸÑ€å ÿ±ŸæŸàÿ±Ÿπÿ≥ ÿßŸàÿ± ÿ™ÿ¨ÿ≤€åÿßÿ™</h2>
                </div>
                <div style="padding: 20px;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ÿ±ŸæŸàÿ±Ÿπ ⁄©€å ŸÇÿ≥ŸÖ:</label>
                            <select id="rt1" onchange="rp1()">
                                <option value="daily">ÿ±Ÿàÿ≤ÿßŸÜ€Å</option>
                                <option value="weekly">€ÅŸÅÿ™€Å Ÿàÿßÿ±</option>
                                <option value="monthly">ŸÖÿß€ÅÿßŸÜ€Å</option>
                                <option value="yearly">ÿ≥ÿßŸÑÿßŸÜ€Å</option>
                                <option value="custom">⁄©ÿ≥ŸπŸÖ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÿ™ÿßÿ±€åÿÆ:</label>
                            <input type="date" id="rd1" onchange="rp1()">
                        </div>
                        <div class="form-group">
                            <label>ÿßÿÆÿ™ÿ™ÿßŸÖ ÿ™ÿßÿ±€åÿÆ:</label>
                            <input type="date" id="rd2" onchange="rp1()">
                        </div>
                        <div class="form-group">
                            <label>⁄©€åŸπ⁄Øÿ±€å:</label>
                            <select id="rc1" onchange="rp1()">
                                <option value="all">ÿ™ŸÖÿßŸÖ</option>
                                <option value="sales">ÿ≥€åŸÑÿ≤</option>
                                <option value="payments">ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫</option>
                                <option value="pending">ÿ®ÿßŸÇ€å</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-info" onclick="exportReport()">ÿ±ŸæŸàÿ±Ÿπ ÿß€å⁄©ÿ≥ŸæŸàÿ±Ÿπ ⁄©ÿ±€å⁄∫</button>
                        <button class="btn btn-success" onclick="printReport()">ÿ±ŸæŸàÿ±Ÿπ Ÿæÿ±ŸÜŸπ ⁄©ÿ±€å⁄∫</button>
                        <button class="btn btn-warning" onclick="scheduleReport()">ÿ¢ŸπŸà ÿ±ŸæŸàÿ±Ÿπ</button>
                    </div>
                </div>
            </div>
    
            <div id="rpt" class="stats-dashboard"></div>
            
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">ÿ≥€åŸÑÿ≤ Ÿπÿ±€åŸÜ⁄à</div>
                    <div class="card-body">
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ŸπÿßŸæ ⁄©ÿ≥ŸπŸÖÿ±ÿ≤</div>
                    <div class="card-body" id="topCustomers"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">ŸπÿßŸæ Ÿæÿ±Ÿà⁄à⁄©Ÿπÿ≥</div>
                    <div class="card-body" id="topProducts"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">ŸÖÿß€ÅÿßŸÜ€Å ŸÖŸàÿßÿ≤ŸÜ€Å</div>
                    <div class="card-body" id="monthlyComparison"></div>
                </div>
            </div>
        </div>
    
        <div id="reminders" class="tab-content">
            <div class="search-panel">
                <div class="search-header">
                    <h2>€åÿßÿØÿØ€ÅÿßŸÜ€å ÿßŸàÿ± ŸÅÿßŸÑŸà ÿßŸæ ÿ≥ÿ≥ŸπŸÖ</h2>
                </div>
                <div style="padding: 20px;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>€åÿßÿØÿØ€ÅÿßŸÜ€å ⁄©€å ŸÇÿ≥ŸÖ:</label>
                            <select id="reminderType">
                                <option value="payment">ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©€å €åÿßÿØÿØ€ÅÿßŸÜ€å</option>
                                <option value="warranty">⁄Øÿßÿ±ŸÜŸπ€å ⁄©€å €åÿßÿØÿØ€ÅÿßŸÜ€å</option>
                                <option value="followup">ŸÅÿßŸÑŸà ÿßŸæ</option>
                                <option value="custom">⁄©ÿ≥ŸπŸÖ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ŸÅŸÑŸπÿ±:</label>
                            <select id="reminderFilter" onchange="loadReminders()">
                                <option value="all">ÿ™ŸÖÿßŸÖ</option>
                                <option value="pending">ÿ®ÿßŸÇ€å ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫</option>
                                <option value="overdue">Ÿàÿßÿ¨ÿ® ÿßŸÑÿßÿØÿß</option>
                                <option value="today">ÿ¢ÿ¨</option>
                                <option value="week">ÿßÿ≥ €ÅŸÅÿ™€í</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÿÆŸàÿØ⁄©ÿßÿ± €åÿßÿØÿØ€ÅÿßŸÜ€å:</label>
                            <select id="autoReminder">
                                <option value="off">ÿ®ŸÜÿØ</option>
                                <option value="daily">ÿ±Ÿàÿ≤ÿßŸÜ€Å</option>
                                <option value="weekly">€ÅŸÅÿ™€Å Ÿàÿßÿ±</option>
                                <option value="monthly">ŸÖÿß€ÅÿßŸÜ€Å</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="sendBulkReminders()">ÿ™ŸÖÿßŸÖ ⁄©Ÿà €åÿßÿØÿØ€ÅÿßŸÜ€å ÿ®⁄æ€åÿ¨€å⁄∫</button>
                        <button class="btn btn-info" onclick="createCustomReminder()">⁄©ÿ≥ŸπŸÖ €åÿßÿØÿØ€ÅÿßŸÜ€å</button>
                        <button class="btn btn-warning" onclick="reminderSettings()">ÿ≥€åŸπŸÜ⁄Øÿ≤</button>
                    </div>
                </div>
            </div>
    
            <div class="stats-dashboard">
                <div class="stat-card">
                    <div class="stat-number" id="totalReminders">0</div>
                    <div class="stat-label">⁄©ŸÑ €åÿßÿØÿØ€ÅÿßŸÜ€åÿß⁄∫</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number" id="sentReminders">0</div>
                    <div class="stat-label">ÿ®⁄æ€åÿ¨€å ⁄Øÿ¶€å⁄∫</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-number" id="pendingReminders">0</div>
                    <div class="stat-label">ÿ®ÿßŸÇ€å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overduePayments">0</div>
                    <div class="stat-label">Ÿàÿßÿ¨ÿ® ÿßŸÑÿßÿØÿß</div>
                </div>
            </div>
    
            <div id="rm1" class="card-grid"></div>
        </div>
    
        <div id="admin" class="tab-content">
            <div class="admin-panel">
                <div class="settings-section">
                    <div class="section-header">
                        <h3>⁄©ÿßÿ±Ÿàÿ®ÿßÿ±€å ŸÖÿπŸÑŸàŸÖÿßÿ™</h3>
                    </div>
                    <div class="section-body">
                        <form id="f2" onsubmit="sv1(event)">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>⁄©ÿßÿ±Ÿàÿ®ÿßÿ±€å ŸÜÿßŸÖ:</label>
                                    <input type="text" id="bn1" required>
                                </div>
                                <div class="form-group">
                                    <label>ŸÅŸàŸÜ ŸÜŸÖÿ®ÿ±:</label>
                                    <input type="tel" id="bp1" required>
                                </div>
                                <div class="form-group">
                                    <label>ÿß€å ŸÖ€åŸÑ:</label>
                                    <input type="email" id="be1">
                                </div>
                                <div class="form-group">
                                    <label>Ÿà€åÿ® ÿ≥ÿßÿ¶Ÿπ:</label>
                                    <input type="url" id="bw1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Ÿæÿ™€Å:</label>
                                <textarea id="ba1" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>ŸÑŸà⁄ØŸà URL:</label>
                                <input type="url" id="bl2">
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>NTN:</label>
                                    <input type="text" id="ntn1">
                                </div>
                                <div class="form-group">
                                    <label>STN:</label>
                                    <input type="text" id="stn1">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success">ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                        </form>
                    </div>
                </div>
    
                <div class="settings-section">
                    <div class="section-header">
                        <h3>ÿ≥ÿ≥ŸπŸÖ ÿ≥€åŸπŸÜ⁄Øÿ≤</h3>
                    </div>
                    <div class="section-body">
                        <form id="systemSettings" onsubmit="saveSystemSettings(event)">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>⁄©ÿ±ŸÜÿ≥€å:</label>
                                    <select id="currency">
                                        <option value="PKR">Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ€å ÿ±ŸàŸæ€å€Å (PKR)</option>
                                        <option value="USD">⁄àÿßŸÑÿ± (USD)</option>
                                        <option value="EUR">€åŸàÿ±Ÿà (EUR)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ÿπ€å⁄©ÿ≥ ÿ±€åŸπ (%):</label>
                                    <input type="number" id="taxRate" min="0" max="100" step="0.01" value="17">
                                </div>
                                <div class="form-group">
                                    <label>ÿ±ÿ≥€åÿØ ⁄©ÿß ÿ≥ÿßÿ¶ÿ≤:</label>
                                    <select id="receiptSize">
                                        <option value="small">⁄Ü⁄æŸàŸπÿß (58mm)</option>
                                        <option value="medium">ÿØÿ±ŸÖ€åÿßŸÜ€Å (80mm)</option>
                                        <option value="large">ÿ®⁄ëÿß (A4)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ÿ≤ÿ®ÿßŸÜ:</label>
                                    <select id="language">
                                        <option value="ur">ÿßÿ±ÿØŸà</option>
                                        <option value="en">ÿßŸÜ⁄Øÿ±€åÿ≤€å</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoBackup"> ÿÆŸàÿØ⁄©ÿßÿ± ÿ®€å⁄© ÿßŸæ
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="soundEffects"> ÿ¢Ÿàÿßÿ≤ ⁄©€í ÿßÿ´ÿ±ÿßÿ™
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                        </form>
                    </div>
                </div>
            </div>
    
            <div style="margin-top: 30px;">
                <div class="settings-section">
                    <div class="section-header">
                        <h3>⁄à€åŸπÿß ŸÖŸÜ€åÿ¨ŸÖŸÜŸπ</h3>
                    </div>
                    <div class="section-body">
                        <div class="data-management">
                            <div class="backup-card" onclick="ex1()">
                                <div class="backup-icon">üì§</div>
                                <h4>⁄à€åŸπÿß ÿß€å⁄©ÿ≥ŸæŸàÿ±Ÿπ</h4>
                                <p>ÿ™ŸÖÿßŸÖ ⁄à€åŸπÿß ⁄©Ÿà ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</p>
                            </div>
                            <div class="backup-card" onclick="document.getElementById('if1').click()">
                                <div class="backup-icon">üì•</div>
                                <h4>⁄à€åŸπÿß ÿßŸÖŸæŸàÿ±Ÿπ</h4>
                                <p>ÿ®€å⁄© ÿßŸæ ŸÅÿßÿ¶ŸÑ ⁄©Ÿà ŸàÿßŸæÿ≥ ŸÑŸà⁄à ⁄©ÿ±€å⁄∫</p>
                            </div>
                            <div class="backup-card" onclick="syncData()">
                                <div class="backup-icon">üîÑ</div>
                                <h4>⁄à€åŸπÿß ÿ≥ŸÜ⁄©</h4>
                                <p>⁄©ŸÑÿßÿ§⁄à ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ≥ŸÜ⁄© ⁄©ÿ±€å⁄∫</p>
                            </div>
                            <div class="backup-card" onclick="cl1()" style="border-color: var(--danger);">
                                <div class="backup-icon" style="color: var(--danger);">üóëÔ∏è</div>
                                <h4 style="color: var(--danger);">⁄à€åŸπÿß ÿµÿßŸÅ ⁄©ÿ±€å⁄∫</h4>
<p style="color: var(--danger);">ÿ™ŸÖÿßŸÖ ⁄à€åŸπÿß ⁄à€åŸÑ€åŸπ ⁄©ÿ±€å⁄∫</p>
</div>
</div>
<input type="file" id="if1" accept=".json" onchange="im1()" style="display: none;">

                        <div style="margin-top: 20px;">
                            <h4>⁄à€åŸπÿßÿ®€åÿ≥ ⁄©€å ÿ≠ÿßŸÑÿ™</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="dbProgress" style="width: 75%;"></div>
                            </div>
                            <p style="font-size: 19px; color: #6c757d; margin-top: 5px;">
                                ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ÿ¥ÿØ€Å: <span id="dbUsage">2.5MB</span> / 5MB
                            </p>
                        </div>
                    </div>
                </div>
            </div>
    
            <div style="margin-top: 30px;">
                <div class="settings-section">
                    <div class="section-header">
                        <h3>ÿ≥⁄©€åŸàÿ±Ÿπ€å ÿßŸàÿ± Ÿæÿ±ŸÖ€åÿ¥ŸÜÿ≤</h3>
                    </div>
                    <div class="section-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ÿß€å⁄àŸÖŸÜ Ÿæÿßÿ≥ Ÿàÿ±⁄à:</label>
                                <input type="password" id="adminPass" placeholder="ŸÜ€åÿß Ÿæÿßÿ≥ Ÿàÿ±⁄à">
                            </div>
                            <div class="form-group">
                                <label>ÿ≥€åÿ¥ŸÜ Ÿπÿßÿ¶ŸÖ ÿ¢ÿ§Ÿπ (ŸÖŸÜŸπ):</label>
                                <input type="number" id="sessionTimeout" value="30" min="5" max="480">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="dataEncryption"> ⁄à€åŸπÿß ÿßŸÜ⁄©ÿ±Ÿæÿ¥ŸÜ
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="auditLog"> ÿ¢⁄àŸπ ŸÑÿß⁄Ø
                            </label>
                        </div>
                        <button class="btn btn-warning" onclick="saveSecuritySettings()">ÿ≥€å⁄©Ÿàÿ±Ÿπ€å ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="floating-actions">
        <button class="fab" onclick="quickReceipt()" title="ŸÅŸàÿ±€å ÿ±ÿ≥€åÿØ">üìÑ</button>
        <button class="fab" onclick="quickSearch()" title="ŸÅŸàÿ±€å ÿ™ŸÑÿßÿ¥">üîç</button>
        <button class="fab" onclick="emergencyBackup()" title="ÿß€åŸÖÿ±ÿ¨ŸÜÿ≥€å ÿ®€å⁄© ÿßŸæ">üíæ</button>
    </div>
    
    <div id="m1" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ÿ™ŸÅÿµ€åŸÑÿßÿ™</h3>
                <button class="close" onclick="cm1()">&times;</button>
            </div>
            <div class="modal-body" id="mc1"></div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script>
        let db2 = null;
        let rs2 = [];
        let bs2 = {};
        let ed2 = null;
        let currentReceiptId = 1001;
        let systemSettings = {
            currency: 'PKR',
            taxRate: 17,
            receiptSize: 'medium',
            language: 'ur',
            autoBackup: false,
            soundEffects: true
        };
    
        const oi2 = () => {
            return new Promise((resolve) => {
                const req = indexedDB.open('ReceiptDB', 2);
                req.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('receipts')) {
                        const store = db.createObjectStore('receipts', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('customerName', 'customerName');
                        store.createIndex('mobile', 'mobile');
                        store.createIndex('status', 'status');
                        store.createIndex('date', 'date');
                        store.createIndex('item', 'item');
                        store.createIndex('receiptNumber', 'receiptNumber');
                    }
                    if (!db.objectStoreNames.contains('business')) {
                        db.createObjectStore('business', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('reminders')) {
                        const reminderStore = db.createObjectStore('reminders', { keyPath: 'id', autoIncrement: true });
                        reminderStore.createIndex('customerId', 'customerId');
                        reminderStore.createIndex('type', 'type');
                        reminderStore.createIndex('status', 'status');
                    }
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'key' });
                    }
                };
                req.onsuccess = () => {
                    db2 = req.result;
                    resolve();
                };
            });
        };
    
        const ar2 = async (receipt) => {
            const tx = db2.transaction(['receipts'], 'readwrite');
            const store = tx.objectStore('receipts');
            return store.add(receipt);
        };
    
        const gr2 = async () => {
            const tx = db2.transaction(['receipts'], 'readonly');
            const store = tx.objectStore('receipts');
            const req = store.getAll();
            return new Promise((resolve) => {
                req.onsuccess = () => resolve(req.result);
            });
        };
    
        const ur2 = async (receipt) => {
            const tx = db2.transaction(['receipts'], 'readwrite');
            const store = tx.objectStore('receipts');
            return store.put(receipt);
        };
    
        const dr2 = async (id) => {
            const tx = db2.transaction(['receipts'], 'readwrite');
            const store = tx.objectStore('receipts');
            return store.delete(id);
        };
    
        const gb2 = async () => {
            const tx = db2.transaction(['business'], 'readonly');
            const store = tx.objectStore('business');
            const req = store.get(1);
            return new Promise((resolve) => {
                req.onsuccess = () => resolve(req.result || {
                    id: 1,
                    name: 'ŸÖ€åÿ±ÿß ⁄©ÿßÿ±Ÿàÿ®ÿßÿ±',
                    phone: '0300-1234567',
                    email: 'business@example.com',
                    address: 'ŸÖ€å⁄∫ ŸÖÿßÿ±⁄©€åŸπÿå ŸÑÿß€ÅŸàÿ±ÿå Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ',
                    logo: '',
                    website: '',
                    ntn: '',
                    stn: ''
                });
            });
        };
    
        const sb2 = async (business) => {
            const tx = db2.transaction(['business'], 'readwrite');
            const store = tx.objectStore('business');
            return store.put(business);
        };
    
        const generateReceiptNumber = () => {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const serial = String(currentReceiptId++).padStart(4, '0');
            return `R${year}${month}${day}${serial}`;
        };
    
        const playSound = (type) => {
            if (!systemSettings.soundEffects) return;
            const audio = new Audio();
            if (type === 'success') {
                audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2k=';
            } else if (type === 'error') {
                audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2kjBThQp+PwtmMcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+Dxu2k=';
            }
            audio.play().catch(() => {});
        };
    
        const showNotification = (message, type = 'info') => {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        };
    
        const calculateTotal = () => {
            const quantity = parseFloat(document.getElementById('qt1').value) || 0;
            const rate = parseFloat(document.getElementById('rt1').value) || 0;
            const discount = parseFloat(document.getElementById('dc1').value) || 0;
            const tax = parseFloat(document.getElementById('tx1').value) || 0;
            
            const subtotal = quantity * rate;
            const afterDiscount = subtotal - discount;
            const taxAmount = (afterDiscount * tax) / 100;
            const total = afterDiscount + taxAmount;
            
            document.getElementById('pr1').value = subtotal.toFixed(2);
            document.getElementById('fn1').value = total.toFixed(2);
            
            calculateBalance();
            calculateMonthlyInstallment();
        };
    
        const calculateBalance = () => {
            const total = parseFloat(document.getElementById('fn1').value) || 0;
            const paid = parseFloat(document.getElementById('pd1').value) || 0;
            const balance = total - paid;
            document.getElementById('bl1').value = balance.toFixed(2);
            
            if (balance > 0) {
                document.getElementById('st1').value = paid > 0 ? 'ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å' : 'ÿßÿØ⁄æÿßÿ±';
            } else {
                document.getElementById('st1').value = 'ÿßÿØÿß ÿ¥ÿØ€Å';
            }
        };
    
        const calculateMonthlyInstallment = () => {
            const balance = parseFloat(document.getElementById('bl1').value) || 0;
            const months = parseInt(document.getElementById('mt1').value) || 1;
            const monthlyInstallment = balance / months;
            document.getElementById('mi1').value = monthlyInstallment.toFixed(2);
            
            if (months > 1) {
                const nextPaymentDate = new Date();
                nextPaymentDate.setMonth(nextPaymentDate.getMonth() + 1);
                document.getElementById('nd1').value = nextPaymentDate.toISOString().split('T');
            }
        };
    
        const lbs = async () => {
            bs2 = await gb2();
            rs2 = await gr2();
            
            currentReceiptId = Math.max(...rs2.map(r => parseInt(r.receiptNumber?.split('R')?.slice(-4)) || 1000), 1000) + 1;
            
            updateHeaderStats();
            dr3();
            lc2();
            s1();
            rp1();
            rm3();
            loadCustomersList();
            updateTodaysStats();
            populateDataLists();
            
            document.getElementById('bn1').value = bs2.name || '';
            document.getElementById('bp1').value = bs2.phone || '';
            document.getElementById('be1').value = bs2.email || '';
            document.getElementById('ba1').value = bs2.address || '';
            document.getElementById('bl2').value = bs2.logo || '';
            document.getElementById('bw1').value = bs2.website || '';
            document.getElementById('ntn1').value = bs2.ntn || '';
            document.getElementById('stn1').value = bs2.stn || '';
            
            const today = new Date().toISOString().split('T');
            const now = new Date().toTimeString().slice(0,5);
            const safeToday = new Date().toISOString().split('T')[0];
            document.getElementById('dt1').value = safeToday;
            document.getElementById('rd1').value = safeToday;
            document.getElementById('tm1').value = now;
            document.getElementById('rn1').value = generateReceiptNumber();
        };
    
        const populateDataLists = () => {
            const customers = [...new Set(rs2.map(r => r.customerName))];
            const items = [...new Set(rs2.map(r => r.item))];
            
            const customerList = document.getElementById('customerList');
            const itemList = document.getElementById('itemList');
            
            customerList.innerHTML = customers.map(c => `<option value="${c}">`).join('');
            itemList.innerHTML = items.map(i => `<option value="${i}">`).join('');
        };
    
        const updateHeaderStats = () => {
            const today = new Date().toISOString().split('T');
            const todayReceipts = rs2.filter(r => r.date === today);
            const totalUdhar = rs2.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const totalCustomers = new Set(rs2.map(r => r.customerName)).size;
            const todayTotal = todayReceipts.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            
            document.getElementById('todayTotal').textContent = todayTotal.toLocaleString();
            document.getElementById('totalUdhar').textContent = totalUdhar.toLocaleString();
            document.getElementById('totalCustomers').textContent = totalCustomers;
        };
    
        const updateTodaysStats = () => {
            const today = new Date().toISOString().split('T');
            const todayReceipts = rs2.filter(r => r.date === today);
            const todayAmount = todayReceipts.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const todayPaid = todayReceipts.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const todayPending = todayAmount - todayPaid;
            
            document.getElementById('todayReceipts').textContent = todayReceipts.length;
            document.getElementById('todayAmount').textContent = todayAmount.toLocaleString();
            document.getElementById('todayPaid').textContent = todayPaid.toLocaleString();
            document.getElementById('todayPending').textContent = todayPending.toLocaleString();
        };
    
        const t1 = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'reports') {
                setTimeout(() => rp1(), 100);
            } else if (tabName === 'reminders') {
                setTimeout(() => rm3(), 100);
            }
        };
    
        const a1 = async (event) => {
            event.preventDefault();
            
            const receipt = {
                receiptNumber: document.getElementById('rn1').value,
                date: document.getElementById('dt1').value,
                time: document.getElementById('tm1').value,
                customerName: document.getElementById('nm1').value,
                mobile: document.getElementById('mb1').value,
                address: document.getElementById('ad1').value,
                cnic: document.getElementById('cn1').value,
                item: document.getElementById('it1').value,
                brand: document.getElementById('br1').value,
                quantity: parseInt(document.getElementById('qt1').value),
                rate: parseFloat(document.getElementById('rt1').value),
                price: parseFloat(document.getElementById('pr1').value),
                discount: parseFloat(document.getElementById('dc1').value) || 0,
                tax: parseFloat(document.getElementById('tx1').value) || 0,
                finalAmount: parseFloat(document.getElementById('fn1').value),
                paidAmount: parseFloat(document.getElementById('pd1').value) || 0,
                balance: parseFloat(document.getElementById('bl1').value) || 0,
                paymentMethod: document.getElementById('pm1').value,
                months: parseInt(document.getElementById('mt1').value),
                monthlyInstallment: parseFloat(document.getElementById('mi1').value),
                nextPaymentDate: document.getElementById('nd1').value,
                warranty: parseInt(document.getElementById('wr1').value),
                agent: document.getElementById('ag1').value,
                status: document.getElementById('st1').value,
                signature: document.getElementById('sg1').value,
                notes: document.getElementById('nt1').value,
                timestamp: new Date().toISOString()
            };
    
            try {
                if (ed2) {
                    receipt.id = ed2;
                    await ur2(receipt);
                    showNotification('ÿ±ÿ≥€åÿØ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ÿßŸæ⁄à€åŸπ €ÅŸà ⁄Øÿ¶€å!', 'success');
                    ed2 = null;
                    document.querySelector('#f1 button[type="submit"]').textContent = 'ÿ±ÿ≥€åÿØ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫';
                } else {
                    await ar2(receipt);
                    showNotification('ŸÜÿ¶€å ÿ±ÿ≥€åÿØ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å!', 'success');
                }
                
                playSound('success');
                rs2 = await gr2();
                updateHeaderStats();
                dr3();
                lc2();
                updateTodaysStats();
                populateDataLists();
                r1();
            } catch (error) {
                showNotification('ÿÆÿ±ÿßÿ®€å: ÿ±ÿ≥€åÿØ ŸÖÿ≠ŸÅŸàÿ∏ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€å!', 'error');
                playSound('error');
            }
        };
    
        const saveAndPrint = async () => {
            await a1({ preventDefault: () => {} });
            const lastReceipt = rs2[rs2.length - 1];
            if (lastReceipt) {
                pr1(lastReceipt.id);
            }
        };
    
        const previewReceipt = () => {
            const receipt = {
                receiptNumber: document.getElementById('rn1').value,
                date: document.getElementById('dt1').value,
                time: document.getElementById('tm1').value,
                customerName: document.getElementById('nm1').value,
                mobile: document.getElementById('mb1').value,
                item: document.getElementById('it1').value,
                finalAmount: document.getElementById('fn1').value,
                status: document.getElementById('st1').value
            };
            
            const content = generateReceiptHTML(receipt, true);
            document.getElementById('modalTitle').textContent = 'ÿ±ÿ≥€åÿØ ⁄©ÿß Ÿæ€åÿ¥ ŸÜÿ∏ÿßÿ±€Å';
            document.getElementById('mc1').innerHTML = content;
            document.getElementById('m1').style.display = 'block';
        };
    
        const r1 = () => {
            document.getElementById('f1').reset();
            const today = new Date().toISOString().split('T');
            const now = new Date().toTimeString().slice(0,5);
            document.getElementById('dt1').value = today;
            document.getElementById('tm1').value = now;
            document.getElementById('rn1').value = generateReceiptNumber();
            document.getElementById('qt1').value = 1;
            document.getElementById('mt1').value = 1;
            document.getElementById('wr1').value = 12;
            document.getElementById('dc1').value = 0;
            document.getElementById('tx1').value = systemSettings.taxRate;
            document.getElementById('pd1').value = 0;
            ed2 = null;
            document.querySelector('#f1 button[type="submit"]').textContent = 'ÿ±ÿ≥€åÿØ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫';
        };
    
        const dr3 = () => {
            const container = document.getElementById('rl1');
            container.innerHTML = '';
            
            const sortedReceipts = rs2.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedReceipts.slice(0, 10).forEach(receipt => {
                const div = document.createElement('div');
                div.className = 'receipt-item';
                div.innerHTML = `
                    <div class="receipt-header">
                        <div class="receipt-info">
                            <h4>${receipt.customerName} - ${receipt.item}</h4>
                            <p>ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±: ${receipt.receiptNumber || 'N/A'}</p>
                            <p>ÿ™ÿßÿ±€åÿÆ: ${receipt.date} | ŸàŸÇÿ™: ${receipt.time || 'N/A'}</p>
                            <p>ÿ±ŸÇŸÖ: ${(receipt.finalAmount || receipt.price).toLocaleString()} | ŸÖŸàÿ®ÿßÿ¶ŸÑ: ${receipt.mobile || 'N/A'}</p>
                        </div>
                        <div class="receipt-status status-${receipt.status === 'ÿßÿØ⁄æÿßÿ±' ? 'udhar' : 'paid'}">
                            ${receipt.status}
                        </div>
                    </div>
                    <div class="receipt-actions">
                        <button class="btn btn-sm btn-info" onclick="pr1(${receipt.id})">Ÿæÿ±ŸÜŸπ</button>
                        <button class="btn btn-sm btn-primary" onclick="er2(${receipt.id})">ÿ™ÿ®ÿØ€åŸÑ ⁄©ÿ±€å⁄∫</button>
                        <button class="btn btn-sm btn-success" onclick="duplicateReceipt(${receipt.id})">⁄©ÿßŸæ€å</button>
                        <button class="btn btn-sm btn-warning" onclick="sendReceipt(${receipt.id})">ÿ®⁄æ€åÿ¨€å⁄∫</button>
                        <button class="btn btn-sm btn-danger" onclick="del1(${receipt.id})">⁄à€åŸÑ€åŸπ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        };
    
        const generateReceiptHTML = (receipt, isPreview = false) => {
            return `
                <div class="print-receipt">
                    <div class="receipt-business">
                        ${bs2.logo ? `<img src="${bs2.logo}" alt="Logo">` : ''}
                        <h2>${bs2.name}</h2>
                        <p>${bs2.address}</p>
                        <p>ŸÅŸàŸÜ: ${bs2.phone}</p>
                        ${bs2.email ? `<p>ÿß€å ŸÖ€åŸÑ: ${bs2.email}</p>` : ''}
                        ${bs2.website ? `<p>Ÿà€åÿ® ÿ≥ÿßÿ¶Ÿπ: ${bs2.website}</p>` : ''}
                        ${bs2.ntn ? `<p>NTN: ${bs2.ntn}</p>` : ''}
                    </div>
                    
                    <div class="receipt-row"><strong>ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±:</strong> <span>${receipt.receiptNumber || 'N/A'}</span></div>
                    <div class="receipt-row"><strong>ÿ™ÿßÿ±€åÿÆ:</strong> <span>${receipt.date}</span></div>
                    <div class="receipt-row"><strong>ŸàŸÇÿ™:</strong> <span>${receipt.time || 'N/A'}</span></div>
                    <div class="receipt-row"><strong>⁄©ÿ≥ŸπŸÖÿ±:</strong> <span>${receipt.customerName}</span></div>
                    ${receipt.mobile ? `<div class="receipt-row"><strong>ŸÖŸàÿ®ÿßÿ¶ŸÑ:</strong> <span>${receipt.mobile}</span></div>` : ''}
                    ${receipt.address ? `<div class="receipt-row"><strong>Ÿæÿ™€Å:</strong> <span>${receipt.address}</span></div>` : ''}
                    ${receipt.cnic ? `<div class="receipt-row"><strong>CNIC:</strong> <span>${receipt.cnic}</span></div>` : ''}
                    
                    <div style="margin: 15px 0; border-top: 1px solid #ccc; padding-top: 10px;">
                        <div class="receipt-row"><strong>ÿ¢ÿ¶ŸπŸÖ:</strong> <span>${receipt.item}</span></div>
                        ${receipt.brand ? `<div class="receipt-row"><strong>ÿ®ÿ±ÿßŸÜ⁄à:</strong> <span>${receipt.brand}</span></div>` : ''}
                        <div class="receipt-row"><strong>ÿ™ÿπÿØÿßÿØ:</strong> <span>${receipt.quantity}</span></div>
                        ${receipt.rate ? `<div class="receipt-row"><strong>ÿ±€åŸπ:</strong> <span>${receipt.rate.toLocaleString()}</span></div>` : ''}
                        <div class="receipt-row"><strong>ŸÇ€åŸÖÿ™:</strong> <span>${(receipt.price || receipt.finalAmount).toLocaleString()}</span></div>
                        ${receipt.discount > 0 ? `<div class="receipt-row"><strong>⁄àÿ≥⁄©ÿßÿ§ŸÜŸπ:</strong> <span>${receipt.discount.toLocaleString()}</span></div>` : ''}
                        ${receipt.tax > 0 ? `<div class="receipt-row"><strong>Ÿπ€å⁄©ÿ≥:</strong> <span>${receipt.tax}%</span></div>` : ''}
                    </div>
                    
                    <div class="receipt-row receipt-total"><strong>⁄©ŸÑ ÿ±ŸÇŸÖ:</strong> <span>${(receipt.finalAmount || receipt.price).toLocaleString()}</span></div>
                    ${receipt.paidAmount > 0 ? `<div class="receipt-row"><strong>ÿßÿØÿß ÿ¥ÿØ€Å:</strong> <span>${receipt.paidAmount.toLocaleString()}</span></div>` : ''}
                    ${receipt.balance > 0 ? `<div class="receipt-row"><strong>ÿ®ÿßŸÇ€å:</strong> <span>${receipt.balance.toLocaleString()}</span></div>` : ''}
                    <div class="receipt-row"><strong>ÿ≠ÿßŸÑÿ™:</strong> <span>${receipt.status}</span></div>
                    ${receipt.paymentMethod ? `<div class="receipt-row"><strong>ÿßÿØÿßÿ¶€å⁄Ø€å:</strong> <span>${receipt.paymentMethod}</span></div>` : ''}
                    
                    ${receipt.months > 1 ? `
                        <div style="margin: 15px 0; border-top: 1px solid #ccc; padding-top: 10px;">
                            <div class="receipt-row"><strong>ŸÇÿ≥ÿ∑€å⁄∫:</strong> <span>${receipt.months} ŸÖ€Å€åŸÜ€í</span></div>
                            <div class="receipt-row"><strong>ŸÖÿß€ÅÿßŸÜ€Å ŸÇÿ≥ÿ∑:</strong> <span>${(receipt.monthlyInstallment || 0).toLocaleString()}</span></div>
                            ${receipt.nextPaymentDate ? `<div class="receipt-row"><strong>ÿß⁄ØŸÑ€å ÿßÿØÿßÿ¶€å⁄Ø€å:</strong> <span>${receipt.nextPaymentDate}</span></div>` : ''}
                        </div>
                    ` : ''}
                    
                    ${receipt.warranty > 0 ? `<div class="receipt-row"><strong>⁄Øÿßÿ±ŸÜŸπ€å:</strong> <span>${receipt.warranty} ŸÖ€Å€åŸÜ€í</span></div>` : ''}
                    ${receipt.agent ? `<div class="receipt-row"><strong>ÿß€åÿ¨ŸÜŸπ:</strong> <span>${receipt.agent}</span></div>` : ''}
                    ${receipt.notes ? `<div style="margin-top: 15px;"><strong>ŸÜŸàŸπÿ≥:</strong><br>${receipt.notes}</div>` : ''}
                    ${receipt.signature ? `<div style="margin-top: 20px;"><strong>ÿØÿ≥ÿ™ÿÆÿ∑:</strong><br>${receipt.signature}</div>` : ''}
                    
                    <div class="receipt-footer">
                        <p>ÿ¥⁄©ÿ±€å€Å! ÿØŸàÿ®ÿßÿ±€Å ÿ™ÿ¥ÿ±€åŸÅ ŸÑÿßÿ¶€å⁄∫</p>
                        <p>Developed by: Yasin Ullah (Pakistani Developer)</p>
                        <p>Print Time: ${new Date().toLocaleString('ur-PK')}</p>
                    </div>
                </div>
                ${!isPreview ? '<br><button class="btn btn-primary" onclick="window.print()">Ÿæÿ±ŸÜŸπ ⁄©ÿ±€å⁄∫</button>' : ''}
            `;
        };
    
        const pr1 = (id) => {
            const receipt = rs2.find(r => r.id === id);
            if (!receipt) return;
    
            const content = generateReceiptHTML(receipt);
            document.getElementById('modalTitle').textContent = 'ÿ±ÿ≥€åÿØ Ÿæÿ±ŸÜŸπ';
            document.getElementById('mc1').innerHTML = content;
            document.getElementById('m1').style.display = 'block';
        };
    
        const er2 = (id) => {
            const receipt = rs2.find(r => r.id === id);
            if (!receipt) return;
    
            ed2 = id;
            document.getElementById('rn1').value = receipt.receiptNumber || '';
            document.getElementById('dt1').value = receipt.date;
            document.getElementById('tm1').value = receipt.time || '';
            document.getElementById('nm1').value = receipt.customerName;
            document.getElementById('mb1').value = receipt.mobile || '';
            document.getElementById('ad1').value = receipt.address || '';
            document.getElementById('cn1').value = receipt.cnic || '';
            document.getElementById('it1').value = receipt.item;
            document.getElementById('br1').value = receipt.brand || '';
            document.getElementById('qt1').value = receipt.quantity;
            document.getElementById('rt1').value = receipt.rate || '';
            document.getElementById('pr1').value = receipt.price;
            document.getElementById('dc1').value = receipt.discount || 0;
            document.getElementById('tx1').value = receipt.tax || 0;
            document.getElementById('fn1').value = receipt.finalAmount || receipt.price;
            document.getElementById('pd1').value = receipt.paidAmount || 0;
            document.getElementById('bl1').value = receipt.balance || 0;
            document.getElementById('pm1').value = receipt.paymentMethod || 'ŸÜŸÇÿØ';
            document.getElementById('mt1').value = receipt.months || 1;
            document.getElementById('mi1').value = receipt.monthlyInstallment || 0;
            document.getElementById('nd1').value = receipt.nextPaymentDate || '';
            document.getElementById('wr1').value = receipt.warranty || 12;
            document.getElementById('ag1').value = receipt.agent || '';
            document.getElementById('st1').value = receipt.status;
            document.getElementById('sg1').value = receipt.signature || '';
            document.getElementById('nt1').value = receipt.notes || '';
            
            document.querySelector('#f1 button[type="submit"]').textContent = 'ÿ™ÿ®ÿØ€åŸÑ€å ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫';
            t1('receipts');
            showNotification('ÿ±ÿ≥€åÿØ ÿß€å⁄àŸπ ⁄©€í ŸÑ€å€í ŸÑŸà⁄à €ÅŸà ⁄Øÿ¶€å', 'info');
        };
    
        const duplicateReceipt = (id) => {
            const receipt = rs2.find(r => r.id === id);
            if (!receipt) return;
            
            er2(id);
            ed2 = null;
            document.getElementById('rn1').value = generateReceiptNumber();
            document.getElementById('dt1').value = new Date().toISOString().split('T');
            document.getElementById('tm1').value = new Date().toTimeString().slice(0,5);
            document.querySelector('#f1 button[type="submit"]').textContent = 'ÿ±ÿ≥€åÿØ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫';
            showNotification('ÿ±ÿ≥€åÿØ ⁄©ÿßŸæ€å €ÅŸà ⁄Øÿ¶€å - ÿßÿ® ÿßÿ≥€í ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫', 'info');
        };
    
        const sendReceipt = (id) => {
            const receipt = rs2.find(r => r.id === id);
            if (!receipt || !receipt.mobile) {
                showNotification('ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€Å€å⁄∫', 'error');
                return;
            }
            
            const message = `${bs2.name} ÿ≥€í ÿ¢Ÿæ ⁄©€å ÿÆÿ±€åÿØÿßÿ±€å ⁄©€å ÿ±ÿ≥€åÿØ:\n\nÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±: ${receipt.receiptNumber}\nÿ¢ÿ¶ŸπŸÖ: ${receipt.item}\nÿ±ŸÇŸÖ: ${(receipt.finalAmount || receipt.price).toLocaleString()}\nÿ≠ÿßŸÑÿ™: ${receipt.status}\n\nÿ¥⁄©ÿ±€å€Å!`;
            window.open(`https://wa.me/${receipt.mobile}?text=${encodeURIComponent(message)}`);
        };
    
        const del1 = async (id) => {
            if (confirm('⁄©€åÿß ÿ¢Ÿæ ŸàÿßŸÇÿπ€å €å€Å ÿ±ÿ≥€åÿØ ⁄à€åŸÑ€åŸπ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü\n€å€Å ÿπŸÖŸÑ ŸàÿßŸæÿ≥ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©ÿ™ÿß!')) {
                try {
                    await dr2(id);
                    rs2 = await gr2();
                    updateHeaderStats();
                    dr3();
                    s1();
                    lc2();
                    updateTodaysStats();
                    showNotification('ÿ±ÿ≥€åÿØ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ⁄à€åŸÑ€åŸπ €ÅŸà ⁄Øÿ¶€å', 'success');
                    playSound('success');
                } catch (error) {
                    showNotification('ÿÆÿ±ÿßÿ®€å: ÿ±ÿ≥€åÿØ ⁄à€åŸÑ€åŸπ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€å', 'error');
                    playSound('error');
                }
            }
        };
    
        const s1 = () => {
            const name = document.getElementById('sn1').value.toLowerCase();
            const mobile = document.getElementById('sm1').value;
            const item = document.getElementById('si1').value.toLowerCase();
            const receiptNumber = document.getElementById('sr1').value;
            const status = document.getElementById('ss1').value;
            const minAmount = parseFloat(document.getElementById('mn1').value) || 0;
            const maxAmount = parseFloat(document.getElementById('mx1').value) || Infinity;
            const startDate = document.getElementById('sd1').value;
            const endDate = document.getElementById('ed1').value;
            const brand = document.getElementById('sb1').value.toLowerCase();
            const agent = document.getElementById('sa1').value.toLowerCase();
            const sortBy = document.getElementById('so1').value;
    
            let filtered = rs2.filter(receipt => {
                const matchName = !name || receipt.customerName.toLowerCase().includes(name);
                const matchMobile = !mobile || receipt.mobile?.includes(mobile);
                const matchItem = !item || receipt.item.toLowerCase().includes(item);
                const matchReceipt = !receiptNumber || receipt.receiptNumber?.includes(receiptNumber);
                const matchStatus = !status || receipt.status === status;
                const matchMinAmount = (receipt.finalAmount || receipt.price) >= minAmount;
                const matchMaxAmount = (receipt.finalAmount || receipt.price) <= maxAmount;
                const matchStartDate = !startDate || receipt.date >= startDate;
                const matchEndDate = !endDate || receipt.date <= endDate;
                const matchBrand = !brand || receipt.brand?.toLowerCase().includes(brand);
                const matchAgent = !agent || receipt.agent?.toLowerCase().includes(agent);
    
                return matchName && matchMobile && matchItem && matchReceipt && matchStatus && 
                       matchMinAmount && matchMaxAmount && matchStartDate && matchEndDate && 
                       matchBrand && matchAgent;
            });
    
            // Sort results
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'date_desc': return new Date(b.timestamp) - new Date(a.timestamp);
                    case 'date_asc': return new Date(a.timestamp) - new Date(b.timestamp);
                    case 'amount_desc': return (b.finalAmount || b.price) - (a.finalAmount || a.price);
                    case 'amount_asc': return (a.finalAmount || a.price) - (b.finalAmount || b.price);
                    default: return new Date(b.timestamp) - new Date(a.timestamp);
                }
            });
    
            // Update search stats
            const totalAmount = filtered.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const pendingAmount = filtered.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.balance || 0), 0);
    
            document.getElementById('searchTotal').textContent = filtered.length;
            document.getElementById('searchAmount').textContent = totalAmount.toLocaleString();
            document.getElementById('searchPending').textContent = pendingAmount.toLocaleString();
    
            const container = document.getElementById('sr2');
            container.innerHTML = '';
    
            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">⁄©Ÿàÿ¶€å ŸÜÿ™€åÿ¨€Å ŸÜ€Å€å⁄∫ ŸÖŸÑÿß</div>';
                return;
            }
    
            filtered.forEach(receipt => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        ${receipt.customerName} - ${receipt.receiptNumber || 'N/A'}
                        <span class="receipt-status status-${receipt.status === 'ÿßÿØ⁄æÿßÿ±' ? 'udhar' : 'paid'}" style="float: left;">
                            ${receipt.status}
                        </span>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div><strong>ÿ¢ÿ¶ŸπŸÖ:</strong> ${receipt.item}</div>
                            <div><strong>ÿ™ÿßÿ±€åÿÆ:</strong> ${receipt.date}</div>
                            <div><strong>ÿ±ŸÇŸÖ:</strong> ${(receipt.finalAmount || receipt.price).toLocaleString()}</div>
                            <div><strong>ŸÖŸàÿ®ÿßÿ¶ŸÑ:</strong> ${receipt.mobile || 'N/A'}</div>
                            ${receipt.brand ? `<div><strong>ÿ®ÿ±ÿßŸÜ⁄à:</strong> ${receipt.brand}</div>` : ''}
                            ${receipt.agent ? `<div><strong>ÿß€åÿ¨ŸÜŸπ:</strong> ${receipt.agent}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-sm btn-info" onclick="pr1(${receipt.id})">Ÿæÿ±ŸÜŸπ</button>
                            <button class="btn btn-sm btn-primary" onclick="er2(${receipt.id})">ÿ™ÿ®ÿØ€åŸÑ ⁄©ÿ±€å⁄∫</button>
                            <button class="btn btn-sm btn-success" onclick="duplicateReceipt(${receipt.id})">⁄©ÿßŸæ€å</button>
                            <button class="btn btn-sm btn-warning" onclick="sendReceipt(${receipt.id})">ÿ®⁄æ€åÿ¨€å⁄∫</button>
                            <button class="btn btn-sm btn-danger" onclick="del1(${receipt.id})">⁄à€åŸÑ€åŸπ</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
                
        };
    
        const clearFilters = () => {
            document.getElementById('sn1').value = '';
            document.getElementById('sm1').value = '';
            document.getElementById('si1').value = '';
            document.getElementById('sr1').value = '';
            document.getElementById('ss1').value = '';
            document.getElementById('mn1').value = '';
            document.getElementById('mx1').value = '';
            document.getElementById('sd1').value = '';
            document.getElementById('ed1').value = '';
            document.getElementById('sb1').value = '';
            document.getElementById('sa1').value = '';
            document.getElementById('so1').value = 'date_desc';
            s1();
        };
    
        const exportSearchResults = () => {
            // Implementation for exporting search results
            showNotification('ÿ≥ÿ±⁄Ü ÿß€å⁄©ÿ≥ŸæŸàÿ±Ÿπ ŸÅ€å⁄Üÿ± ÿ¨ŸÑÿØ ÿ¢ÿ¶€í ⁄Øÿß', 'info');
        };
    
        const bulkUpdate = () => {
            // Implementation for bulk update
            showNotification('ÿ®ŸÑ⁄© ÿßŸæ⁄à€åŸπ ŸÅ€å⁄Üÿ± ÿ¨ŸÑÿØ ÿ¢ÿ¶€í ⁄Øÿß', 'info');
        };
    
        const lc2 = () => {
            const customers = [...new Set(rs2.map(r => r.customerName))];
            const select = document.getElementById('lc1');
            select.innerHTML = '<option value="">⁄©ÿ≥ŸπŸÖÿ± ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer;
                option.textContent = customer;
                select.appendChild(option);
            });
        };
    
        const loadCustomersList = () => {
            const customers = [...new Set(rs2.map(r => r.customerName))];
            const container = document.getElementById('customersList');
            container.innerHTML = '';
    
            customers.forEach(customer => {
                const customerReceipts = rs2.filter(r => r.customerName === customer);
                const totalAmount = customerReceipts.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
                const paidAmount = customerReceipts.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
                const balance = totalAmount - paidAmount;
                const recentReceipt = customerReceipts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        ${customer}
                        <span class="receipt-status ${balance > 0 ? 'status-udhar' : 'status-paid'}" style="float: left;">
                            ${balance > 0 ? 'ÿ®ÿßŸÇ€å: ' + balance.toLocaleString() : '⁄©ŸÑ€åÿ±'}
                        </span>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div><strong>⁄©ŸÑ Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜ:</strong> ${customerReceipts.length}</div>
                            <div><strong>⁄©ŸÑ ÿ±ŸÇŸÖ:</strong> ${totalAmount.toLocaleString()}</div>
                            <div><strong>ÿßÿØÿß ÿ¥ÿØ€Å:</strong> ${paidAmount.toLocaleString()}</div>
                            <div><strong>ÿ¢ÿÆÿ±€å ÿÆÿ±€åÿØÿßÿ±€å:</strong> ${recentReceipt?.date || 'N/A'}</div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="viewCustomerLedger('${customer}')">ÿ™ŸÅÿµ€åŸÑ€å ⁄©⁄æÿßÿ™€Å</button>
                        ${recentReceipt?.mobile ? `<button class="btn btn-sm btn-success" onclick="contactCustomer('${recentReceipt.mobile}', '${customer}')">ÿ±ÿßÿ®ÿ∑€Å</button>` : ''}
                    </div>
                `;
                container.appendChild(card);
            });
        };
    
        const viewCustomerLedger = (customer) => {
            document.getElementById('lc1').value = customer;
            l1();
            t1('ledger');
        };
    
        const contactCustomer = (mobile, name) => {
            const message = `ÿ≥ŸÑÿßŸÖ ${name} ÿµÿßÿ≠ÿ®ÿå ${bs2.name} ÿ≥€í ÿ±ÿßÿ®ÿ∑€Å ⁄©ÿ± ÿ±€Å€í €Å€å⁄∫€î ⁄©€åÿß ÿ≠ÿßŸÑ €Å€íÿü`;
            window.open(`https://wa.me/${mobile}?text=${encodeURIComponent(message)}`);
        };
    
        const l1 = () => {
            const customer = document.getElementById('lc1').value;
            const filter = document.getElementById('lf1').value;
            const startDate = document.getElementById('ld1').value;
            const endDate = document.getElementById('ld2').value;
    
            if (!customer) {
                document.getElementById('lb1').style.display = 'none';
                document.getElementById('lt1').innerHTML = '';
                return;
            }
    
            let customerReceipts = rs2.filter(r => r.customerName === customer);
    
            // Apply filters
            if (filter === 'pending') {
                customerReceipts = customerReceipts.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å');
            } else if (filter === 'paid') {
                customerReceipts = customerReceipts.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å');
            } else if (filter === 'current_month') {
                const currentMonth = new Date().toISOString().slice(0, 7);
                customerReceipts = customerReceipts.filter(r => r.date.startsWith(currentMonth));
            }
    
            if (startDate) {
                customerReceipts = customerReceipts.filter(r => r.date >= startDate);
            }
            if (endDate) {
                customerReceipts = customerReceipts.filter(r => r.date <= endDate);
            }
    
            const totalAmount = customerReceipts.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const paidAmount = customerReceipts.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const balance = totalAmount - paidAmount;
    
            document.getElementById('totalTransactions').textContent = customerReceipts.length;
            document.getElementById('totalPurchases').textContent = totalAmount.toLocaleString();
            document.getElementById('outstandingBalance').textContent = balance.toLocaleString();
            document.getElementById('lb1').style.display = 'block';
    
            const container = document.getElementById('lt1');
            container.innerHTML = '';
    
            customerReceipts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(receipt => {
                const div = document.createElement('div');
                div.className = 'receipt-item';
                div.innerHTML = `
                    <div class="receipt-header">
                        <div class="receipt-info">
                            <h4>${receipt.item} - ${receipt.receiptNumber || 'N/A'}</h4>
                            <p>ÿ™ÿßÿ±€åÿÆ: ${receipt.date} | ÿ±ŸÇŸÖ: ${(receipt.finalAmount || receipt.price).toLocaleString()}</p>
                            ${receipt.balance > 0 ? `<p>ÿ®ÿßŸÇ€å: ${receipt.balance.toLocaleString()}</p>` : ''}
                        </div>
                        <div class="receipt-status status-${receipt.status === 'ÿßÿØ⁄æÿßÿ±' ? 'udhar' : 'paid'}">
                            ${receipt.status}
                        </div>
                    </div>
                    <div class="receipt-actions">
                        <button class="btn btn-sm btn-info" onclick="pr1(${receipt.id})">Ÿæÿ±ŸÜŸπ</button>
                        <button class="btn btn-sm btn-primary" onclick="er2(${receipt.id})">ÿ™ÿ®ÿØ€åŸÑ ⁄©ÿ±€å⁄∫</button>
                        ${receipt.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å' ? `<button class="btn btn-sm btn-success" onclick="markAsPaid(${receipt.id})">ÿßÿØÿß ÿ¥ÿØ€Å</button>` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        };
    
        const markAsPaid = async (id) => {
            const receipt = rs2.find(r => r.id === id);
            if (!receipt) return;
    
            receipt.status = 'ÿßÿØÿß ÿ¥ÿØ€Å';
            receipt.paidAmount = receipt.finalAmount || receipt.price;
            receipt.balance = 0;
    
            try {
                await ur2(receipt);
                rs2 = await gr2();
                l1();
                updateHeaderStats();
                showNotification('ÿ±ÿ≥€åÿØ ÿßÿØÿß ÿ¥ÿØ€Å ⁄©€í ÿ∑Ÿàÿ± Ÿæÿ± ÿßŸæ⁄à€åŸπ €ÅŸà ⁄Øÿ¶€å', 'success');
                playSound('success');
            } catch (error) {
                showNotification('ÿÆÿ±ÿßÿ®€å: ÿßŸæ⁄à€åŸπ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©ÿß', 'error');
                playSound('error');
            }
        };
    
        const rp1 = () => {
            const type = document.getElementById('rt1').value;
            const startDate = document.getElementById('rd1').value;
            let endDate = document.getElementById('rd2').value;
            const category = document.getElementById('rc1').value;
            
            let filterStartDate, filterEndDate;
    
            if (type === 'daily') {
                filterStartDate = filterEndDate = startDate;
            } else if (type === 'weekly') {
                const date = new Date(startDate);
                const start = new Date(date);
                start.setDate(date.getDate() - date.getDay());
                const end = new Date(start);
                end.setDate(start.getDate() + 6);
                filterStartDate = start.toISOString().split('T');
                filterEndDate = end.toISOString().split('T');
            } else if (type === 'monthly') {
                const date = new Date(startDate);
                filterStartDate = new Date(date.getFullYear(), date.getMonth(), 1).toISOString().split('T');
                filterEndDate = new Date(date.getFullYear(), date.getMonth() + 1, 0).toISOString().split('T');
            } else if (type === 'yearly') {
                const date = new Date(startDate);
                filterStartDate = new Date(date.getFullYear(), 0, 1).toISOString().split('T');
                filterEndDate = new Date(date.getFullYear(), 11, 31).toISOString().split('T');
            } else if (type === 'custom') {
                filterStartDate = startDate;
                filterEndDate = endDate || startDate;
            }
    
            let filtered = rs2.filter(r => r.date >= filterStartDate && r.date <= filterEndDate);
    
            if (category === 'sales') {
                // All receipts are sales
            } else if (category === 'payments') {
                filtered = filtered.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å');
            } else if (category === 'pending') {
                filtered = filtered.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å');
            }
    
            const totalReceipts = filtered.length;
            const totalSales = filtered.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const totalPaid = filtered.filter(r => r.status === 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            const totalPending = filtered.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å').reduce((sum, r) => sum + (r.balance || r.finalAmount || r.price), 0);
            const avgSale = totalReceipts > 0 ? totalSales / totalReceipts : 0;
    
            // Previous period comparison
            const periodLength = Math.ceil((new Date(filterEndDate) - new Date(filterStartDate)) / (1000 * 60 * 60 * 24)) + 1;
            let prevFiltered = [];
            try {
                const prevStartDate = new Date(filterStartDate);
                const prevEndDate = new Date(filterEndDate);
                
                if (!isNaN(prevStartDate.getTime()) && !isNaN(prevEndDate.getTime())) {
                    prevStartDate.setDate(prevStartDate.getDate() - periodLength);
                    prevEndDate.setDate(prevEndDate.getDate() - periodLength);
                    
                    const prevStartStr = prevStartDate.toISOString().split('T')[0];
                    const prevEndStr = prevEndDate.toISOString().split('T')[0];
                    
                    prevFiltered = rs2.filter(r => r.date >= prevStartStr && r.date <= prevEndStr);
                }
            } catch (error) {
                console.warn('Date calculation error, using empty previous data');
                prevFiltered = [];
            }
            const prevTotalSales = prevFiltered.reduce((sum, r) => sum + (r.finalAmount || r.price), 0);
            
            const salesChange = prevTotalSales > 0 ? ((totalSales - prevTotalSales) / prevTotalSales * 100).toFixed(1) : 0;
            const receiptChange = prevFiltered.length > 0 ? ((totalReceipts - prevFiltered.length) / prevFiltered.length * 100).toFixed(1) : 0;
    
            document.getElementById('rpt').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalReceipts}</div>
                    <div class="stat-label">⁄©ŸÑ Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜ</div>
                    <div class="stat-change ${receiptChange >= 0 ? 'change-positive' : 'change-negative'}">
                        ${receiptChange >= 0 ? '+' : ''}${receiptChange}%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalSales.toLocaleString()}</div>
                    <div class="stat-label">⁄©ŸÑ ÿ≥€åŸÑÿ≤</div>
                    <div class="stat-change ${salesChange >= 0 ? 'change-positive' : 'change-negative'}">
                        ${salesChange >= 0 ? '+' : ''}${salesChange}%
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number">${totalPaid.toLocaleString()}</div>
                    <div class="stat-label">ÿßÿØÿß ÿ¥ÿØ€Å ÿ±ŸÇŸÖ</div>
                    <div class="stat-change change-positive">
                        ${totalSales > 0 ? ((totalPaid / totalSales) * 100).toFixed(1) : 0}%
                    </div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-number">${totalPending.toLocaleString()}</div>
                    <div class="stat-label">ÿ®ÿßŸÇ€å ÿ±ŸÇŸÖ</div>
                    <div class="stat-change change-negative">
                        ${totalSales > 0 ? ((totalPending / totalSales) * 100).toFixed(1) : 0}%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${avgSale.toLocaleString()}</div>
                    <div class="stat-label">ÿßŸàÿ≥ÿ∑ ÿ≥€åŸÑ</div>
                    <div class="stat-change change-positive">ŸÅ€å Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${new Set(filtered.map(r => r.customerName)).size}</div>
                    <div class="stat-label">ŸÖŸÜŸÅÿ±ÿØ ⁄©ÿ≥ŸπŸÖÿ±ÿ≤</div>
                    <div class="stat-change change-positive">ÿßÿ≥ Ÿæ€åÿ±€å⁄à ŸÖ€å⁄∫</div>
                </div>
            `;
    
            // Generate top customers
            const customerStats = {};
            filtered.forEach(r => {
                if (!customerStats[r.customerName]) {
                    customerStats[r.customerName] = { count: 0, total: 0 };
                }
                customerStats[r.customerName].count++;
                customerStats[r.customerName].total += (r.finalAmount || r.price);
            });
    
            const topCustomers = Object.entries(customerStats)
                .sort(([,a], [,b]) => b.total - a.total)
                .slice(0, 5);
    
            document.getElementById('topCustomers').innerHTML = topCustomers.map(([name, stats]) => `
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                    <div>
                        <strong>${name}</strong><br>
                        <small>${stats.count} ÿÆÿ±€åÿØÿßÿ±€å</small>
                    </div>
                    <div style="text-align: right;">
                        <strong>${stats.total.toLocaleString()}</strong>
                    </div>
                </div>
            `).join('') || '<p>⁄©Ÿàÿ¶€å ⁄à€åŸπÿß ŸÜ€Å€å⁄∫</p>';
    
            // Generate top products
            const productStats = {};
            filtered.forEach(r => {
                if (!productStats[r.item]) {
                    productStats[r.item] = { count: 0, revenue: 0 };
                }
                productStats[r.item].count += r.quantity || 1;
                productStats[r.item].revenue += (r.finalAmount || r.price);
            });
    
            const topProducts = Object.entries(productStats)
                .sort(([,a], [,b]) => b.revenue - a.revenue)
                .slice(0, 5);
    
            document.getElementById('topProducts').innerHTML = topProducts.map(([item, stats]) => `
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                    <div>
                        <strong>${item}</strong><br>
                        <small>${stats.count} €åŸàŸÜŸπ</small>
                    </div>
                    <div style="text-align: right;">
                        <strong>${stats.revenue.toLocaleString()}</strong>
                    </div>
                </div>
            `).join('') || '<p>⁄©Ÿàÿ¶€å ⁄à€åŸπÿß ŸÜ€Å€å⁄∫</p>';
    
            // Monthly comparison (last 6 months)
            const monthlyData = {};
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthKey = date.toISOString().slice(0, 7);
                monthlyData[monthKey] = { receipts: 0, sales: 0 };
            }
    
            rs2.forEach(r => {
                const monthKey = r.date.slice(0, 7);
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey].receipts++;
                    monthlyData[monthKey].sales += (r.finalAmount || r.price);
                }
            });
    
            document.getElementById('monthlyComparison').innerHTML = Object.entries(monthlyData)
                .map(([month, data]) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${new Date(month).toLocaleDateString('ur-PK', { year: 'numeric', month: 'long' })}</strong><br>
                            <small>${data.receipts} ÿ±ÿ≥€åÿØ€å⁄∫</small>
                        </div>
                        <div style="text-align: right;">
                            <strong>${data.sales.toLocaleString()}</strong>
                        </div>
                    </div>
                `).join('') || '<p>⁄©Ÿàÿ¶€å ⁄à€åŸπÿß ŸÜ€Å€å⁄∫</p>';
                };

        const exportReport = () => {
            const type = document.getElementById('rt1').value;
            const startDate = document.getElementById('rd1').value;
            const endDate = document.getElementById('rd2').value || startDate;
            
            const reportData = {
                reportType: type,
                period: `${startDate} to ${endDate}`,
                generatedAt: new Date().toISOString(),
                business: bs2,
                summary: {
                    totalReceipts: document.getElementById('rpt').children.length > 0 ? document.getElementById('rpt').children.children.textContent : '0',
                    totalSales: document.getElementById('rpt').children.length > 1 ? document.getElementById('rpt').children.children.textContent : '0',
                    totalPaid: document.getElementById('rpt').children.length > 2 ? document.getElementById('rpt').children.children.textContent : '0',
                    totalPending: document.getElementById('rpt').children.length > 3 ? document.getElementById('rpt').children.children.textContent : '0'
                }
            };
    
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report-${type}-${startDate}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('ÿ±ŸæŸàÿ±Ÿπ ÿß€å⁄©ÿ≥ŸæŸàÿ±Ÿπ €ÅŸà ⁄Øÿ¶€å', 'success');
        };
    
        const printReport = () => {
            const reportContent = document.getElementById('rpt').outerHTML + 
                                 document.getElementById('topCustomers').parentElement.outerHTML +
                                 document.getElementById('topProducts').parentElement.outerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>ÿ±ŸæŸàÿ±Ÿπ - ${bs2.name}</title>
                        <style>
                            body { font-family: Arial, sans-serif; direction: rtl; }
                            .stats-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
                            .stat-card { border: 1px solid #ddd; padding: 20px; text-align: center; }
                            .stat-number { font-size: 24px; font-weight: bold; }
                            .card { border: 1px solid #ddd; margin: 20px 0; padding: 15px; }
                            .card-header { font-weight: bold; margin-bottom: 10px; }
                        </style>
                    </head>
                    <body>
                        <h1>${bs2.name} - ÿ™ŸÅÿµ€åŸÑ€å ÿ±ŸæŸàÿ±Ÿπ</h1>
                        <p>ÿ™ÿßÿ±€åÿÆ: ${new Date().toLocaleString('ur-PK')}</p>
                        ${reportContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        };
    
        const scheduleReport = () => {
            showNotification('ÿ¢ŸπŸà ÿ±ŸæŸàÿ±Ÿπ ŸÅ€å⁄Üÿ± ÿ¨ŸÑÿØ ÿ¢ÿ¶€í ⁄Øÿß', 'info');
        };
    
        const rm3 = () => {
            const filter = document.getElementById('reminderFilter')?.value || 'all';
            let receiptsToShow = [];
    
            if (filter === 'pending') {
                receiptsToShow = rs2.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å');
            } else if (filter === 'overdue') {
                const today = new Date().toISOString().split('T');
                receiptsToShow = rs2.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å' && r.nextPaymentDate && r.nextPaymentDate < today);
            } else if (filter === 'today') {
                const today = new Date().toISOString().split('T');
                receiptsToShow = rs2.filter(r => r.nextPaymentDate === today);
            } else if (filter === 'week') {
                const today = new Date();
                const nextWeek = new Date();
                nextWeek.setDate(today.getDate() + 7);
                const todayStr = today.toISOString().split('T');
                const nextWeekStr = nextWeek.toISOString().split('T');
                receiptsToShow = rs2.filter(r => r.nextPaymentDate >= todayStr && r.nextPaymentDate <= nextWeekStr);
            } else {
                receiptsToShow = rs2.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å');
            }
    
            // Update reminder stats
            const totalReminders = receiptsToShow.length;
            const overdueCount = rs2.filter(r => {
                const today = new Date().toISOString().split('T');
                return r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å' && r.nextPaymentDate && r.nextPaymentDate < today;
            }).length;
    
            document.getElementById('totalReminders').textContent = totalReminders;
            document.getElementById('pendingReminders').textContent = receiptsToShow.filter(r => r.status === 'ÿßÿØ⁄æÿßÿ±').length;
            document.getElementById('overduePayments').textContent = overdueCount;
            document.getElementById('sentReminders').textContent = '0'; // Would be tracked in real implementation
    
            const container = document.getElementById('rm1');
            container.innerHTML = '';
    
            if (receiptsToShow.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">⁄©Ÿàÿ¶€å €åÿßÿØÿØ€ÅÿßŸÜ€å ŸÜ€Å€å⁄∫</div>';
                return;
            }
    
            receiptsToShow.forEach(receipt => {
                const isOverdue = receipt.nextPaymentDate && receipt.nextPaymentDate < new Date().toISOString().split('T');
                const daysOverdue = isOverdue ? Math.floor((new Date() - new Date(receipt.nextPaymentDate)) / (1000 * 60 * 60 * 24)) : 0;
    
                const card = document.createElement('div');
                card.className = 'reminder-card';
                card.innerHTML = `
                    <div class="reminder-header" style="background: ${isOverdue ? 'linear-gradient(45deg, #ff6b6b, #ffa500)' : 'linear-gradient(45deg, #ff9a9e 0%, #fecfef 100%)'}">
                        ${receipt.customerName} - ${receipt.item}
                        ${isOverdue ? `<span style="float: left; background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 12px; font-size: 17px;">${daysOverdue} ÿØŸÜ ÿ≤€åÿßÿØ€Å</span>` : ''}
                    </div>
                    <div class="reminder-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div><strong>ÿ±ÿ≥€åÿØ ŸÜŸÖÿ®ÿ±:</strong> ${receipt.receiptNumber || 'N/A'}</div>
                            <div><strong>ÿ®ÿßŸÇ€å ÿ±ŸÇŸÖ:</strong> ${(receipt.balance || 0).toLocaleString()}</div>
                            <div><strong>ŸÖŸàÿ®ÿßÿ¶ŸÑ:</strong> ${receipt.mobile || 'N/A'}</div>
                            <div><strong>ÿß⁄ØŸÑ€å ÿßÿØÿßÿ¶€å⁄Ø€å:</strong> ${receipt.nextPaymentDate || 'N/A'}</div>
                        </div>
                        ${receipt.notes ? `<p><strong>ŸÜŸàŸπÿ≥:</strong> ${receipt.notes}</p>` : ''}
                    </div>
                    <div class="reminder-actions">
                        <button class="btn btn-sm btn-success" onclick="sendWhatsAppReminder('${receipt.mobile}', '${receipt.customerName}', ${receipt.balance || 0}, '${receipt.nextPaymentDate || ''}')" ${!receipt.mobile ? 'disabled' : ''}>WhatsApp</button>
                        <button class="btn btn-sm btn-info" onclick="sendSMSReminder('${receipt.mobile}', '${receipt.customerName}', ${receipt.balance || 0})" ${!receipt.mobile ? 'disabled' : ''}>SMS</button>
                        <button class="btn btn-sm btn-warning" onclick="callCustomer('${receipt.mobile}')" ${!receipt.mobile ? 'disabled' : ''}>⁄©ÿßŸÑ</button>
                        <button class="btn btn-sm btn-primary" onclick="er2(${receipt.id})">ÿ™ÿ®ÿØ€åŸÑ ⁄©ÿ±€å⁄∫</button>
                        <button class="btn btn-sm btn-success" onclick="markAsPaid(${receipt.id})">ÿßÿØÿß ÿ¥ÿØ€Å</button>
                    </div>
                `;
                container.appendChild(card);
            });
        };
    
        const sendWhatsAppReminder = (mobile, name, amount, nextPayment) => {
            if (!mobile) {
                showNotification('ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€Å€å⁄∫', 'error');
                return;
            }
    
            const message = `ÿ≥ŸÑÿßŸÖ ${name} ÿµÿßÿ≠ÿ®ÿå\n\n${bs2.name} ÿ≥€í €åÿßÿØÿØ€ÅÿßŸÜ€å:\n\nÿ¢Ÿæ ⁄©ÿß ${amount.toLocaleString()} ÿ±ŸàŸæ€í ⁄©ÿß ÿ®ŸÇ€å€Å ÿßÿØ⁄æÿßÿ± €Å€í€î${nextPayment ? `\n\nÿß⁄ØŸÑ€å ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©€å ÿ™ÿßÿ±€åÿÆ: ${nextPayment}` : ''}\n\nÿ®ÿ±ÿßÿ¶€í ⁄©ÿ±ŸÖ ÿ¨ŸÑÿØ ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©ÿ±€å⁄∫€î\n\nÿ¥⁄©ÿ±€å€Å\n${bs2.name}\nŸÅŸàŸÜ: ${bs2.phone}`;
            
            window.open(`https://wa.me/${mobile}?text=${encodeURIComponent(message)}`);
            showNotification(`${name} ⁄©Ÿà WhatsApp €åÿßÿØÿØ€ÅÿßŸÜ€å ÿ®⁄æ€åÿ¨€å ⁄Øÿ¶€å`, 'success');
        };
    
        const sendSMSReminder = (mobile, name, amount) => {
            if (!mobile) {
                showNotification('ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€Å€å⁄∫', 'error');
                return;
            }
    
            const message = `ÿ≥ŸÑÿßŸÖ ${name} ÿµÿßÿ≠ÿ®ÿå ÿ¢Ÿæ ⁄©ÿß ${amount.toLocaleString()} ÿ±ŸàŸæ€í ⁄©ÿß ÿßÿØ⁄æÿßÿ± ÿ®ÿßŸÇ€å €Å€í€î ÿ®ÿ±ÿßÿ¶€í ⁄©ÿ±ŸÖ ÿ¨ŸÑÿØ ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©ÿ±€å⁄∫€î ÿ¥⁄©ÿ±€å€Å - ${bs2.name}`;
            window.open(`sms:${mobile}?body=${encodeURIComponent(message)}`);
            showNotification(`${name} ⁄©Ÿà SMS €åÿßÿØÿØ€ÅÿßŸÜ€å ÿ®⁄æ€åÿ¨€å ⁄Øÿ¶€å`, 'success');
        };
    
        const callCustomer = (mobile) => {
            if (!mobile) {
                showNotification('ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€Å€å⁄∫', 'error');
                return;
            }
            window.open(`tel:${mobile}`);
        };
    
        const sendBulkReminders = () => {
            const pendingReceipts = rs2.filter(r => r.status !== 'ÿßÿØÿß ÿ¥ÿØ€Å' && r.mobile);
            
            if (pendingReceipts.length === 0) {
                showNotification('⁄©Ÿàÿ¶€å ÿ®ÿßŸÇ€å ÿßÿØÿßÿ¶€å⁄Ø€å ŸÜ€Å€å⁄∫ ŸÖŸÑ€å', 'info');
                return;
            }
    
            if (confirm(`${pendingReceipts.length} ⁄©ÿ≥ŸπŸÖÿ±ÿ≤ ⁄©Ÿà €åÿßÿØÿØ€ÅÿßŸÜ€å ÿ®⁄æ€åÿ¨ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü`)) {
                pendingReceipts.forEach((receipt, index) => {
                    setTimeout(() => {
                        sendWhatsAppReminder(receipt.mobile, receipt.customerName, receipt.balance || 0, receipt.nextPaymentDate);
                    }, index * 1000); // 1 second delay between messages
                });
                showNotification(`${pendingReceipts.length} €åÿßÿØÿØ€ÅÿßŸÜ€åÿß⁄∫ ÿ®⁄æ€åÿ¨€å ÿ¨ÿß ÿ±€Å€å €Å€å⁄∫`, 'success');
            }
        };
    
        const createCustomReminder = () => {
            const content = `
                <h3>⁄©ÿ≥ŸπŸÖ €åÿßÿØÿØ€ÅÿßŸÜ€å ÿ®ŸÜÿßÿ¶€å⁄∫</h3>
                <form onsubmit="saveCustomReminder(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>⁄©ÿ≥ŸπŸÖÿ± ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫:</label>
                            <select id="reminderCustomer" required>
                                <option value="">ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</option>
                                ${[...new Set(rs2.map(r => r.customerName))].map(name => `<option value="${name}">${name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>€åÿßÿØÿØ€ÅÿßŸÜ€å ⁄©€å ŸÇÿ≥ŸÖ:</label>
                            <select id="reminderTypeCustom" required>
                                <option value="payment">ÿßÿØÿßÿ¶€å⁄Ø€å</option>
                                <option value="followup">ŸÅÿßŸÑŸà ÿßŸæ</option>
                                <option value="warranty">⁄Øÿßÿ±ŸÜŸπ€å</option>
                                <option value="custom">ÿØ€å⁄Øÿ±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÿ™ÿßÿ±€åÿÆ:</label>
                            <input type="date" id="reminderDate" required>
                        </div>
                        <div class="form-group">
                            <label>Ÿæ€åÿ∫ÿßŸÖ:</label>
                            <textarea id="reminderMessage" rows="4" required placeholder="€åÿßÿØÿØ€ÅÿßŸÜ€å ⁄©ÿß Ÿæ€åÿ∫ÿßŸÖ ŸÑ⁄©⁄æ€å⁄∫"></textarea>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="submit" class="btn btn-success">€åÿßÿØÿØ€ÅÿßŸÜ€å ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                        <button type="button" class="btn" onclick="cm1()">ŸÖŸÜÿ≥ŸàÿÆ</button>
                    </div>
                </form>
            `;
    
            document.getElementById('modalTitle').textContent = '⁄©ÿ≥ŸπŸÖ €åÿßÿØÿØ€ÅÿßŸÜ€å';
            document.getElementById('mc1').innerHTML = content;
            document.getElementById('m1').style.display = 'block';
        };
    
        const saveCustomReminder = (event) => {
            event.preventDefault();
            // In a real implementation, this would save to IndexedDB
            showNotification('⁄©ÿ≥ŸπŸÖ €åÿßÿØÿØ€ÅÿßŸÜ€å ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å', 'success');
            cm1();
        };
    
        const reminderSettings = () => {
            const content = `
                <h3>€åÿßÿØÿØ€ÅÿßŸÜ€å ÿ≥€åŸπŸÜ⁄Øÿ≤</h3>
                <form onsubmit="saveReminderSettings(event)">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="autoRemindersEnabled" checked> ÿÆŸàÿØ⁄©ÿßÿ± €åÿßÿØÿØ€ÅÿßŸÜ€åÿß⁄∫
                        </label>
                    </div>
                    <div class="form-group">
                        <label>€åÿßÿØÿØ€ÅÿßŸÜ€å ⁄©ÿß ŸàŸÇŸÅ€Å (ÿØŸÜ):</label>
                        <input type="number" id="reminderInterval" value="3" min="1" max="30">
                    </div>
                    <div class="form-group">
                        <label>ÿ≤€åÿßÿØ€Å ÿ≥€í ÿ≤€åÿßÿØ€Å €åÿßÿØÿØ€ÅÿßŸÜ€åÿß⁄∫:</label>
                        <input type="number" id="maxReminders" value="3" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label>€åÿßÿØÿØ€ÅÿßŸÜ€å ⁄©ÿß Ÿæ€åÿ∫ÿßŸÖ Ÿπ€åŸÖŸæŸÑ€åŸπ:</label>
                        <textarea id="reminderTemplate" rows="4">ÿ≥ŸÑÿßŸÖ {name} ÿµÿßÿ≠ÿ®ÿå ÿ¢Ÿæ ⁄©ÿß {amount} ÿ±ŸàŸæ€í ⁄©ÿß ÿßÿØ⁄æÿßÿ± ÿ®ÿßŸÇ€å €Å€í€î ÿ®ÿ±ÿßÿ¶€í ⁄©ÿ±ŸÖ ÿ¨ŸÑÿØ ÿßÿØÿßÿ¶€å⁄Ø€å ⁄©ÿ±€å⁄∫€î ÿ¥⁄©ÿ±€å€Å - {business}</textarea>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="submit" class="btn btn-success">ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫</button>
                        <button type="button" class="btn" onclick="cm1()">ŸÖŸÜÿ≥ŸàÿÆ</button>
                    </div>
                </form>
            `;
    
            document.getElementById('modalTitle').textContent = '€åÿßÿØÿØ€ÅÿßŸÜ€å ÿ≥€åŸπŸÜ⁄Øÿ≤';
            document.getElementById('mc1').innerHTML = content;
            document.getElementById('m1').style.display = 'block';
        };
    
        const saveReminderSettings = (event) => {
            event.preventDefault();
            showNotification('€åÿßÿØÿØ€ÅÿßŸÜ€å ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å⁄∫', 'success');
            cm1();
        };
    
        const loadReminders = () => {
            rm3();
        };
    
        const sv1 = async (event) => {
            event.preventDefault();
            const business = {
                id: 1,
                name: document.getElementById('bn1').value,
                phone: document.getElementById('bp1').value,
                email: document.getElementById('be1').value,
                website: document.getElementById('bw1').value,
                address: document.getElementById('ba1').value,
                logo: document.getElementById('bl1').value,
                ntn: document.getElementById('ntn1').value,
                stn: document.getElementById('stn1').value
            };
    
            try {
                await sb2(business);
                bs2 = business;
                updateHeaderStats();
                showNotification('⁄©ÿßÿ±Ÿàÿ®ÿßÿ±€å ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å⁄∫!', 'success');
                playSound('success');
            } catch (error) {
                showNotification('ÿÆÿ±ÿßÿ®€å: ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€å⁄∫', 'error');
                playSound('error');
            }
        };
    
        const saveSystemSettings = (event) => {
            event.preventDefault();
            systemSettings = {
                currency: document.getElementById('currency').value,
                taxRate: parseFloat(document.getElementById('taxRate').value),
                receiptSize: document.getElementById('receiptSize').value,
                language: document.getElementById('language').value,
                autoBackup: document.getElementById('autoBackup').checked,
                soundEffects: document.getElementById('soundEffects').checked
            };
    
            // Save to localStorage for persistence
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            showNotification('ÿ≥ÿ≥ŸπŸÖ ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å⁄∫!', 'success');
            playSound('success');
        };
    
        const saveSecuritySettings = () => {
            const adminPass = document.getElementById('adminPass').value;
            const sessionTimeout = document.getElementById('sessionTimeout').value;
            const dataEncryption = document.getElementById('dataEncryption').checked;
            const auditLog = document.getElementById('auditLog').checked;
    
            // In a real implementation, these would be securely stored
            if (adminPass) {
                localStorage.setItem('adminPassword', btoa(adminPass)); // Basic encoding, not secure
            }
            
            localStorage.setItem('securitySettings', JSON.stringify({
                sessionTimeout,
                dataEncryption,
                auditLog
            }));
    
            showNotification('ÿ≥€å⁄©Ÿàÿ±Ÿπ€å ÿ≥€åŸπŸÜ⁄Øÿ≤ ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å⁄∫!', 'success');
            playSound('success');
        };
    
        const ex1 = () => {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                receipts: rs2,
                business: bs2,
                systemSettings: systemSettings,
                metadata: {
                    totalReceipts: rs2.length,
                    totalSales: rs2.reduce((sum, r) => sum + (r.finalAmount || r.price), 0),
                    exportedBy: 'Yasin Ullah Receipt System'
                }
            };
    
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `receipt-backup-${new Date().toISOString().split('T')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('⁄à€åŸπÿß ÿ®€å⁄© ÿßŸæ ÿ™€åÿßÿ± €ÅŸà ⁄Ø€åÿß!', 'success');
            playSound('success');
        };
    
        const im1 = () => {
            const file = document.getElementById('if1').files;
            if (!file) return;
    
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.receipts || !Array.isArray(data.receipts)) {
                        throw new Error('Invalid backup file format');
                    }
    
                    let importedCount = 0;
                    for (const receipt of data.receipts) {
                        // Check if receipt already exists
                        const exists = rs2.find(r => r.receiptNumber === receipt.receiptNumber);
                        if (!exists) {
                            await ar2(receipt);
                            importedCount++;
                        }
                    }
                    
                    if (data.business) {
                        await sb2(data.business);
                    }
    
                    if (data.systemSettings) {
                        systemSettings = { ...systemSettings, ...data.systemSettings };
                        localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
                    }
    
                    await lbs();
                    showNotification(`${importedCount} ÿ±ÿ≥€åÿØ€å⁄∫ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ÿßŸÖŸæŸàÿ±Ÿπ €ÅŸàÿ¶€å⁄∫!`, 'success');
                    playSound('success');
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification('ÿÆÿ±ÿßÿ®€å: ⁄à€åŸπÿß ÿßŸÖŸæŸàÿ±Ÿπ ŸÖ€å⁄∫ ŸÖÿ≥ÿ¶ŸÑ€Å!', 'error');
                    playSound('error');
                }
            };
            reader.readAsText(file);
        };
    
        const syncData = () => {
            showNotification('⁄©ŸÑÿßÿ§⁄à ÿ≥ŸÜ⁄© ŸÅ€å⁄Üÿ± ÿ¨ŸÑÿØ ÿ¢ÿ¶€í ⁄Øÿß', 'info');
        };
    
        const cl1 = () => {
            if (confirm('⁄©€åÿß ÿ¢Ÿæ ŸàÿßŸÇÿπ€å ÿ™ŸÖÿßŸÖ ⁄à€åŸπÿß ÿµÿßŸÅ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü\n\n€å€Å ÿπŸÖŸÑ ŸàÿßŸæÿ≥ ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©ÿ™ÿß!\n\nÿ®ÿ±ÿßÿ¶€í ⁄©ÿ±ŸÖ Ÿæ€ÅŸÑ€í ⁄à€åŸπÿß ⁄©ÿß ÿ®€å⁄© ÿßŸæ ŸÑ€í ŸÑ€å⁄∫€î')) {
                if (confirm('ÿ¢ÿÆÿ±€å ÿ™ÿµÿØ€åŸÇ: ⁄©€åÿß ÿ¢Ÿæ ŸàÿßŸÇÿπ€å ÿ™ŸÖÿßŸÖ ⁄à€åŸπÿß ⁄à€åŸÑ€åŸπ ⁄©ÿ±ŸÜÿß ⁄Üÿß€Åÿ™€í €Å€å⁄∫ÿü')) {
                    indexedDB.deleteDatabase('ReceiptDB');
                    localStorage.clear();
                    showNotification('ÿ™ŸÖÿßŸÖ ⁄à€åŸπÿß ÿµÿßŸÅ €ÅŸà ⁄Ø€åÿß - ÿµŸÅÿ≠€Å ÿØŸàÿ®ÿßÿ±€Å ŸÑŸà⁄à €ÅŸà ÿ±€Åÿß €Å€í', 'info');
                    setTimeout(() => location.reload(), 2000);
                }
            }
        };
    
        const cm1 = () => {
            document.getElementById('m1').style.display = 'none';
        };
    
        // Quick action functions
        const quickReceipt = () => {
            t1('receipts');
            r1();
            showNotification('ŸÜÿ¶€å ÿ±ÿ≥€åÿØ ⁄©€í ŸÑ€å€í ÿ™€åÿßÿ±', 'info');
        };
    
        const quickSearch = () => {
            t1('search');
            document.getElementById('sn1').focus();
        };
    
        const todayReport = () => {
            document.getElementById('rt1').value = 'daily';
            document.getElementById('rd1').value = new Date().toISOString().split('T');
            rp1();
            t1('reports');
        };
    
        const emergencyBackup = () => {
            ex1();
        };
    
        const showPendingPayments = () => {
            document.getElementById('ss1').value = 'ÿßÿØ⁄æÿßÿ±';
            s1();
            t1('search');
        };
    
        const showExpiringWarranties = () => {
            const today = new Date();
            const nextMonth = new Date();
            nextMonth.setMonth(today.getMonth() + 1);
            
            const expiringWarranties = rs2.filter(r => {
                if (!r.warranty || r.warranty <= 0) return false;
                const purchaseDate = new Date(r.date);
                const expiryDate = new Date(purchaseDate);
                expiryDate.setMonth(expiryDate.getMonth() + r.warranty);
                return expiryDate <= nextMonth && expiryDate >= today;
            });
    
            if (expiringWarranties.length === 0) {
                showNotification('⁄©Ÿàÿ¶€å ⁄Øÿßÿ±ŸÜŸπ€å ÿÆÿ™ŸÖ ŸÜ€Å€å⁄∫ €ÅŸà ÿ±€Å€å', 'info');
                return;
            }
    
            const content = `
                <h3>ÿÆÿ™ŸÖ €ÅŸàÿ™€å ⁄Øÿßÿ±ŸÜŸπ€åÿß⁄∫</h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${expiringWarranties.map(r => {
                        const purchaseDate = new Date(r.date);
                        const expiryDate = new Date(purchaseDate);
                        expiryDate.setMonth(expiryDate.getMonth() + r.warranty);
                        return `
                            <div style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px;">
                                <h4>${r.customerName} - ${r.item}</h4>
                                <p>ÿÆÿ±€åÿØÿßÿ±€å: ${r.date} | ⁄Øÿßÿ±ŸÜŸπ€å ÿÆÿ™ŸÖ: ${expiryDate.toISOString().split('T')}</p>
                                <p>ŸÖŸàÿ®ÿßÿ¶ŸÑ: ${r.mobile || 'N/A'}</p>
                                <button class="btn btn-sm btn-success" onclick="contactCustomer('${r.mobile}', '${r.customerName}')" ${!r.mobile ? 'disabled' : ''}>ÿ±ÿßÿ®ÿ∑€Å ⁄©ÿ±€å⁄∫</button>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
    
            document.getElementById('modalTitle').textContent = 'ÿÆÿ™ŸÖ €ÅŸàÿ™€å ⁄Øÿßÿ±ŸÜŸπ€åÿß⁄∫';
            document.getElementById('mc1').innerHTML = content;
            document.getElementById('m1').style.display = 'block';
        };
    
        const generateInvoice = () => {
            showNotification('ÿßŸÜŸàÿßÿ¶ÿ≥ ÿ¨ŸÜÿ±€åŸπÿ± ŸÅ€å⁄Üÿ± ÿ¨ŸÑÿØ ÿ¢ÿ¶€í ⁄Øÿß', 'info');
        };
    
        // Initialize the application
        window.onclick = (event) => {
            if (event.target === document.getElementById('m1')) {
                cm1();
            }
        };
    
        // Load saved system settings
        const savedSettings = localStorage.getItem('systemSettings');
        if (savedSettings) {
            systemSettings = { ...systemSettings, ...JSON.parse(savedSettings) };
        }
    
        // Populate system settings form
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('currency').value = systemSettings.currency;
            document.getElementById('taxRate').value = systemSettings.taxRate;
            document.getElementById('receiptSize').value = systemSettings.receiptSize;
            document.getElementById('language').value = systemSettings.language;
            document.getElementById('autoBackup').checked = systemSettings.autoBackup;
            document.getElementById('soundEffects').checked = systemSettings.soundEffects;
        });
    
        // Auto-backup functionality
        if (systemSettings.autoBackup) {
            setInterval(() => {
                if (rs2.length > 0) {
                    ex1();
                }
            }, 24 * 60 * 60 * 1000); // Daily backup
        }
    
        // Initialize the database and load data
        oi2().then(() => {
            lbs();
        }).catch(error => {
            console.error('Database initialization failed:', error);
            showNotification('⁄à€åŸπÿßÿ®€åÿ≥ ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±ŸÜ€í ŸÖ€å⁄∫ ÿÆÿ±ÿßÿ®€å!', 'error');
        });
    
        // Update database usage indicator
        const updateDBUsage = () => {
            if (navigator.storage && navigator.storage.estimate) {
                navigator.storage.estimate().then(estimate => {
                    const used = (estimate.usage / (1024 * 1024)).toFixed(2);
                    const quota = (estimate.quota / (1024 * 1024)).toFixed(2);
                    const percentage = ((estimate.usage / estimate.quota) * 100).toFixed(1);
                    
                    document.getElementById('dbUsage').textContent = `${used}MB`;
                    document.getElementById('dbProgress').style.width = `${percentage}%`;
                });
            }
        };
    
        // Update DB usage every 30 seconds
        setInterval(updateDBUsage, 30000);
        updateDBUsage();
    
        // Service Worker for offline functionality (if needed)
       if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {
                // Silently ignore service worker registration failures
            });
        }
    
    </script>
    </body>
</html>
<script>
const fontUrl = "https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap";

const link = document.createElement("link");
link.rel = "stylesheet";
link.href = fontUrl;
document.head.appendChild(link);

const style = document.createElement("style");
style.innerHTML = `
  * {
    font-family: Calibri, 'Noto Nastaliq Urdu', "Jameel Noori Nastaleeq" !important;
  }
  input, textarea, select, button {
    font-family: Calibri, 'Noto Nastaliq Urdu', "Jameel Noori Nastaleeq" !important;
  }
`;
document.head.appendChild(style);
window.addEventListener("load", () => {
    setTimeout(() => {
        document.getElementById("sa1").value = "";
    }, 400);
    
});

</script>



<script>
/// Adding Sample data


// Sample data generator for Pakistani Receipt Management System
const generateSampleData = async () => {
    const pakistaniNames = [
        'ŸÖÿ≠ŸÖÿØ ÿßÿ≠ŸÖÿØ', 'ÿπŸÑ€å ÿ≠ÿ≥ŸÜ', 'ŸÅÿßÿ∑ŸÖ€Å ÿÆÿßŸÜ', 'ÿπÿßÿ¶ÿ¥€Å ÿπŸÑ€å', 'ÿ≠ÿ≥ŸÜ ŸÖÿ≠ŸÖŸàÿØ',
        'ÿ≤€åŸÜÿ® ÿßÿ≠ŸÖÿØ', 'ÿπÿ´ŸÖÿßŸÜ ÿ¥ÿß€Å', 'ÿÆÿØ€åÿ¨€Å ÿ®€å⁄ØŸÖ', 'ÿßÿ®ÿ±ÿß€Å€åŸÖ ÿÆÿßŸÜ', 'ŸÖÿ±€åŸÖ ŸÅÿßÿ∑ŸÖ€Å',
        '€åŸàÿ≥ŸÅ ÿπŸÑ€å', 'ÿµŸÅ€å€Å ÿÆÿßÿ™ŸàŸÜ', 'ÿπŸÖÿ± ŸÅÿßÿ±ŸàŸÇ', 'ÿ±ŸÇ€å€Å ÿ®€å⁄ØŸÖ', 'ÿ∑ÿßÿ±ŸÇ ŸÖÿ≠ŸÖŸàÿØ',
        'ŸÜÿßÿ¶ŸÑ€Å ÿ¥ÿß€Å', 'ÿ≥ŸÑŸÖÿßŸÜ ÿßÿ≠ŸÖÿØ', 'ÿ±ÿ≠ŸÖ€Å ÿÆÿßŸÜ', '⁄©ÿ±€åŸÖ ÿ®ÿÆÿ¥', 'ÿ¥ÿß€Å€åŸÜ ÿ®€å⁄ØŸÖ'
    ];

    const mobileNumbers = [
        '03001234567', '03211234567', '03451234567', '03331234567', '03041234567',
        '03015678901', '03225678901', '03465678901', '03345678901', '03055678901',
        '03019876543', '03239876543', '03479876543', '03359876543', '03069876543',
        '03012345678', '03242345678', '03482345678', '03362345678', '03072345678'
    ];

    const addresses = [
        '⁄ØŸÑÿ®ÿ±⁄Øÿå ŸÑÿß€ÅŸàÿ±', '⁄©ÿ±ÿß⁄Ü€å ⁄©ŸÖŸæŸÜ€åÿå ⁄©ÿ±ÿß⁄Ü€å', 'ÿ®ŸÑ€åŸà ÿß€åÿ±€åÿßÿå ÿßÿ≥ŸÑÿßŸÖ ÿ¢ÿ®ÿßÿØ', 'ÿ¨Ÿà€Åÿ± Ÿπÿßÿ§ŸÜÿå ŸÑÿß€ÅŸàÿ±',
        '⁄à€åŸÅŸÜÿ≥ÿå ⁄©ÿ±ÿß⁄Ü€å', 'ÿß€åŸÅ €î 10ÿå ÿßÿ≥ŸÑÿßŸÖ ÿ¢ÿ®ÿßÿØ', 'ŸÖÿß⁄àŸÑ Ÿπÿßÿ§ŸÜÿå ŸÑÿß€ÅŸàÿ±', '⁄ØŸÑÿ¥ŸÜ ÿßŸÇÿ®ÿßŸÑÿå ⁄©ÿ±ÿß⁄Ü€å',
        'ÿ¨€å €î 9ÿå ÿßÿ≥ŸÑÿßŸÖ ÿ¢ÿ®ÿßÿØ', '⁄©€åŸÜŸπÿå ŸÑÿß€ÅŸàÿ±', '⁄©ŸÑŸÅŸπŸÜÿå ⁄©ÿ±ÿß⁄Ü€å', 'ÿ¢ÿ¶€å €î 8ÿå ÿßÿ≥ŸÑÿßŸÖ ÿ¢ÿ®ÿßÿØ',
        'ŸÅ€åÿµŸÑ ÿ¢ÿ®ÿßÿØ ÿ±Ÿà⁄à', 'ÿ±ÿßŸàŸÑŸæŸÜ⁄à€å ⁄©€åŸÜŸπ', 'ŸÖŸÑÿ™ÿßŸÜ ⁄©€åŸÜŸπ', 'Ÿæÿ¥ÿßŸàÿ± €åŸàŸÜ€åŸàÿ±ÿ≥Ÿπ€å',
        '⁄©Ÿàÿ¶Ÿπ€Å ⁄©€åŸÜŸπ', 'ÿ≠€åÿØÿ±ÿ¢ÿ®ÿßÿØ ÿ≥Ÿπ€å', 'ÿ≥⁄©⁄æÿ± ⁄©€åŸÜŸπ', 'ŸÑÿß⁄ë⁄©ÿßŸÜ€Å ÿ≥Ÿπ€å'
    ];

    const items = [
        'ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÅŸàŸÜ Samsung A54', 'ŸÑ€åŸæ ŸπÿßŸæ HP Pavilion', 'ÿß€åÿ¶ÿ± ⁄©ŸÜ⁄à€åÿ¥ŸÜÿ± Haier', 'LED TV 43 inch',
        'ÿ±€åŸÅÿ±€åÿ¨ÿ±€åŸπÿ± LG', 'Ÿàÿßÿ¥ŸÜ⁄Ø ŸÖÿ¥€åŸÜ Dawlance', 'ŸÖŸàŸπÿ±ÿ≥ÿßÿ¶€å⁄©ŸÑ Honda 125', 'ÿß€åÿ¶ÿ± ⁄©ŸàŸÑÿ± Super Asia',
        'ŸÖÿßÿ¶€å⁄©ÿ±ŸàŸà€åŸà Panasonic', '⁄Ø€åÿ≤ÿ± Pak Electric', 'ŸÅ€åŸÜ Ceiling GFC', 'ÿ¢ÿ¶ÿ±ŸÜ Phillips',
        '€Å€åÿ¶ÿ± ⁄àÿ±ÿßÿ¶ÿ± Nova', 'ÿ®ŸÑ€åŸÜ⁄àÿ± National', '⁄©€åŸπŸÑ Electric', 'ŸπŸàÿ≥Ÿπÿ± Anex',
        '⁄©€åŸÖÿ±€Å Canon DSLR', 'Ÿæÿ±ŸÜŸπÿ± HP LaserJet', 'ÿßÿ≥Ÿæ€å⁄©ÿ± JBL', '€Å€å⁄àŸÅŸàŸÜ Sony'
    ];

    const brands = [
        'Samsung', 'HP', 'Haier', 'LG', 'Dawlance', 'Honda', 'Super Asia', 'Panasonic',
        'Pak Electric', 'GFC', 'Phillips', 'Nova', 'National', 'Anex', 'Canon', 'JBL', 'Sony'
    ];

    const agents = [
        'ÿßÿ≠ŸÖÿØ ÿπŸÑ€å', 'ŸÅÿ±ÿ≠ÿßŸÜ ÿÆÿßŸÜ', 'ŸÜŸà€åÿØ ÿßÿ≠ŸÖÿØ', 'ÿ∑ÿß€Åÿ± ÿ≠ÿ≥€åŸÜ', 'ÿπÿßÿ±ŸÅ ŸÖÿ≠ŸÖŸàÿØ',
        'ÿ≥ŸÑ€åŸÖ ÿ¥ÿß€Å', '⁄©ÿ±€åŸÖ ÿ®ÿÆÿ¥', 'ÿ±ÿ¥€åÿØ ÿßÿ≠ŸÖÿØ', 'ŸÜÿßÿµÿ± ÿπŸÑ€å', 'ŸÖŸÜ€åÿ± ÿÆÿßŸÜ'
    ];

    const paymentMethods = ['ŸÜŸÇÿØ', 'ÿ®€åŸÜ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸÅÿ±', '⁄Ü€å⁄©', 'ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ'];
    const statuses = ['ÿßÿØ⁄æÿßÿ±', 'ÿßÿØÿß ÿ¥ÿØ€Å', 'ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å'];

    const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const getRandomNumber = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const getRandomDate = (daysBack) => {
        const date = new Date();
        date.setDate(date.getDate() - Math.floor(Math.random() * daysBack));
        return date.toISOString().split('T')[0];
    };

    const generateReceiptNumber = (index) => {
        const date = new Date();
        const year = date.getFullYear().toString().slice(-2);
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const serial = String(1001 + index).padStart(4, '0');
        return `R${year}${month}${day}${serial}`;
    };

    console.log('Generating 20 sample receipts...');

    for (let i = 0; i < 20; i++) {
        const item = getRandomItem(items);
        const quantity = getRandomNumber(1, 5);
        const rate = getRandomNumber(5000, 150000);
        const price = quantity * rate;
        const discount = Math.random() < 0.3 ? getRandomNumber(500, 5000) : 0;
        const tax = 17; // Standard GST rate
        const subtotal = price - discount;
        const taxAmount = (subtotal * tax) / 100;
        const finalAmount = subtotal + taxAmount;
        
        const status = getRandomItem(statuses);
        const paidAmount = status === 'ÿßÿØÿß ÿ¥ÿØ€Å' ? finalAmount : 
                          status === 'ÿ¨ÿ≤Ÿà€å ÿßÿØÿßÿ¶€å⁄Ø€å' ? getRandomNumber(finalAmount * 0.2, finalAmount * 0.8) : 0;
        const balance = finalAmount - paidAmount;
        
        const months = balance > 0 ? getRandomNumber(3, 24) : 1;
        const monthlyInstallment = balance / months;
        
        const receiptDate = getRandomDate(90);
        const nextPaymentDate = balance > 0 ? 
            new Date(new Date(receiptDate).getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : '';

        const receipt = {
            receiptNumber: generateReceiptNumber(i),
            date: receiptDate,
            time: `${getRandomNumber(9, 18)}:${getRandomNumber(0, 59).toString().padStart(2, '0')}`,
            customerName: getRandomItem(pakistaniNames),
            mobile: getRandomItem(mobileNumbers),
            address: getRandomItem(addresses),
            cnic: `${getRandomNumber(10000, 99999)}-${getRandomNumber(1000000, 9999999)}-${getRandomNumber(1, 9)}`,
            item: item,
            brand: getRandomItem(brands),
            quantity: quantity,
            rate: rate,
            price: price,
            discount: discount,
            tax: tax,
            finalAmount: finalAmount,
            paidAmount: paidAmount,
            balance: balance,
            paymentMethod: getRandomItem(paymentMethods),
            months: months,
            monthlyInstallment: monthlyInstallment,
            nextPaymentDate: nextPaymentDate,
            warranty: getRandomNumber(6, 36),
            agent: getRandomItem(agents),
            status: status,
            signature: `ÿØÿ≥ÿ™ÿÆÿ∑: ${getRandomItem(pakistaniNames)}`,
            notes: Math.random() < 0.4 ? `ÿßÿ∂ÿßŸÅ€å ŸÜŸàŸπÿ≥ - ${getRandomItem(['ÿß⁄Ü⁄æÿß ⁄©ÿ≥ŸπŸÖÿ±', 'ÿ®ÿßŸÇÿßÿπÿØ€Å ÿßÿØÿßÿ¶€å⁄Ø€å', 'ÿÆÿµŸàÿµ€å ÿ±ÿπÿß€åÿ™', 'ÿ™€åÿ≤€å ÿ≥€í ⁄à€åŸÑ€åŸàÿ±€å'])}` : '',
            timestamp: new Date().toISOString()
        };

        try {
            await ar2(receipt);
            console.log(`Receipt ${i + 1}/20 generated: ${receipt.customerName} - ${receipt.item}`);
        } catch (error) {
            console.error(`Error generating receipt ${i + 1}:`, error);
        }
    }

    console.log('Sample data generation completed!');
    
    // Refresh the data in the UI
    rs2 = await gr2();
    updateHeaderStats();
    dr3();
    lc2();
    updateTodaysStats();
    populateDataLists();
    
    console.log('UI updated with new sample data');
};

// Generate sample business data
const generateSampleBusiness = async () => {
    const sampleBusiness = {
        id: 1,
        name: 'ÿÆÿßŸÜ ÿßŸÑ€å⁄©Ÿπÿ±ÿßŸÜ⁄©ÿ≥ ÿß€åŸÜ⁄à ÿßŸæŸÑÿßÿ¶ŸÜÿ≥ÿ≤',
        phone: '042-35123456',
        email: 'info@khanelectronics.pk',
        website: 'www.khanelectronics.pk',
        address: 'ÿ¥ÿßŸæ ŸÜŸÖÿ®ÿ± 15-16ÿå ÿ≠ÿßŸÑ ÿ±Ÿà⁄àÿå ÿßŸÜÿßÿ±⁄©ŸÑ€å ÿ®ÿßÿ≤ÿßÿ±ÿå ŸÑÿß€ÅŸàÿ±',
        logo: 'https://via.placeholder.com/200x80/2c3e50/ffffff?text=ÿÆÿßŸÜ+ÿßŸÑ€å⁄©Ÿπÿ±ÿßŸÜ⁄©ÿ≥',
        ntn: '1234567-8',
        stn: 'STN-LHR-001'
    };

    try {
        await sb2(sampleBusiness);
        bs2 = sampleBusiness;
        
        // Update form fields
        document.getElementById('bn1').value = sampleBusiness.name;
        document.getElementById('bp1').value = sampleBusiness.phone;
        document.getElementById('be1').value = sampleBusiness.email;
        document.getElementById('ba1').value = sampleBusiness.address;
        document.getElementById('bl1').value = sampleBusiness.logo;
        document.getElementById('bw1').value = sampleBusiness.website;
        document.getElementById('ntn1').value = sampleBusiness.ntn;
        document.getElementById('stn1').value = sampleBusiness.stn;
        
        updateHeaderStats();
        console.log('Sample business data generated successfully!');
    } catch (error) {
        console.error('Error generating business data:', error);
    }
};

// Generate sample reminders data
const generateSampleReminders = () => {
    console.log('Sample reminders generated (reminders are dynamic based on pending receipts)');
};

// Execute all sample data generation
const generateAllSampleData = async () => {
    console.log('Starting complete sample data generation...');
    
    await generateSampleBusiness();
    await generateSampleData();
    generateSampleReminders();
    
    console.log('All sample data generated successfully!');
    console.log('You can now explore all features of the Receipt Management System');
    console.log('- Check the Receipts tab for generated receipts');
    console.log('- Use Search tab to filter data');
    console.log('- View customer ledgers in Ledger tab');
    console.log('- Check Reports for analytics');
    console.log('- See Reminders for pending payments');
};

// Make functions available globally for console usage uncomment to add this sample data

<!-- window.generateSampleData = generateSampleData; -->
<!-- window.generateSampleBusiness = generateSampleBusiness; -->
<!-- window.generateAllSampleData = generateAllSampleData; -->

<!-- console.log('Sample data generators loaded! Use these commands:'); -->
<!-- console.log('generateSampleData() - Generate 20 sample receipts'); -->
<!-- console.log('generateSampleBusiness() - Generate sample business info'); -->
<!-- console.log('generateAllSampleData() - Generate everything'); -->
<!-- generateAllSampleData(); -->


</script>